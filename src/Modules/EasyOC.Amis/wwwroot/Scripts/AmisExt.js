/*
** NOTE: This file is generated by Gulp and should not be edited directly!
** Any changes made directly to this file will be overwritten next time its asset group is processed by Gulp.
*/

var DynamicFilterOperator;

(function (DynamicFilterOperator) {
  /// <summary>
  /// like
  /// </summary>
  DynamicFilterOperator["Contains"] = "Contains";
  DynamicFilterOperator["StartsWith"] = "StartsWith";
  DynamicFilterOperator["EndsWith"] = "EndsWith";
  DynamicFilterOperator["NotContains"] = "NotContains";
  DynamicFilterOperator["NotStartsWith"] = "NotStartsWith";
  DynamicFilterOperator["NotEndsWith"] = "NotEndsWith"; /// <summary>
  /// =<para></para>
  /// Equal/Equals/Eq 效果相同
  /// </summary>

  DynamicFilterOperator["Equal"] = "Equal"; /// <summary>
  /// =<para></para>
  /// Equal/Equals/Eq 效果相同
  /// </summary>

  DynamicFilterOperator["Equals"] = "Equals"; /// <summary>
  /// =<para></para>
  /// Equal/Equals/Eq 效果相同
  /// </summary>

  DynamicFilterOperator["Eq"] = "Eq"; /// <summary>
  /// &lt;&gt;
  /// </summary>

  DynamicFilterOperator["NotEqual"] = "NotEqual"; /// <summary>
  /// &gt;
  /// </summary>

  DynamicFilterOperator["GreaterThan"] = "GreaterThan"; /// <summary>
  /// &gt;=
  /// </summary>

  DynamicFilterOperator["GreaterThanOrEqual"] = "GreaterThanOrEqual"; /// <summary>
  /// &lt;
  /// </summary>

  DynamicFilterOperator["LessThan"] = "LessThan"; /// <summary>
  /// &lt;=
  /// </summary>

  DynamicFilterOperator["LessThanOrEqual"] = "LessThanOrEqual"; /// <summary>
  /// &gt;= and &lt;<para></para>
  /// 此时 Value 的值格式为逗号分割：value1,value2 或者数组
  /// </summary>

  DynamicFilterOperator["Range"] = "Range"; /// <summary>
  /// &gt;= and &lt;<para></para>
  /// 此时 Value 的值格式为逗号分割：date1,date2 或者数组<para></para>
  /// 这是专门为日期范围查询定制的操作符，它会处理 date2 + 1，比如：<para></para>
  /// 当 date2 选择的是 2020-05-30，那查询的时候是 &lt; 2020-05-31<para></para>
  /// 当 date2 选择的是 2020-05，那查询的时候是 &lt; 2020-06<para></para>
  /// 当 date2 选择的是 2020，那查询的时候是 &lt; 2021<para></para>
  /// 当 date2 选择的是 2020-05-30 12，那查询的时候是 &lt; 2020-05-30 13<para></para>
  /// 当 date2 选择的是 2020-05-30 12:30，那查询的时候是 &lt; 2020-05-30 12:31<para></para>
  /// 并且 date2 只支持以上 5 种格式 (date1 没有限制)
  /// </summary>

  DynamicFilterOperator["DateRange"] = "DateRange"; /// <summary>
  /// in (1,2,3)<para></para>
  /// 此时 Value 的值格式为逗号分割：value1,value2,value3... 或者数组
  /// </summary>

  DynamicFilterOperator["Any"] = "Any"; /// <summary>
  /// not in (1,2,3)<para></para>
  /// 此时 Value 的值格式为逗号分割：value1,value2,value3... 或者数组
  /// </summary>

  DynamicFilterOperator["NotAny"] = "NotAny"; /// <summary>
  /// 自定义解析，此时 Field 为反射信息，Value 为静态方法的参数(string)<para></para>
  /// 示范：{ Operator: "Custom", Field: "RawSql webapp1.DynamicFilterCustom,webapp1", Value: "(id,name) in ((1,'k'),(2,'m'))" }<para></para>
  /// 注意：使用者自己承担【注入风险】<para></para>
  /// 静态方法定义示范：<para></para>
  /// namespace webapp1<para></para>
  /// {<para></para>
  /// public class DynamicFilterCustom<para></para>
  /// {<para></para>
  /// [DynamicFilterCustom]<para></para>
  /// public static string RawSql(object sender, string value) => value;<para></para>
  /// }<para></para>
  /// }<para></para>
  /// </summary>
  // Custom
})(DynamicFilterOperator || (DynamicFilterOperator = {}));

var DynamicFilterLogic;

(function (DynamicFilterLogic) {
  DynamicFilterLogic["And"] = "And";
  DynamicFilterLogic["Or"] = "Or";
})(DynamicFilterLogic || (DynamicFilterLogic = {}));

var DynamicFilterInfo =
/** @class */
function () {
  function DynamicFilterInfo() {
    this.filters = [];
  }

  return DynamicFilterInfo;
}();

function convertToJSONFilter(condition) {
  var arr = condition.map(function (child) {
    var _a, _b;

    var filterItem = {
      logic: (_a = child.conjunction) !== null && _a !== void 0 ? _a : DynamicFilterLogic.And,
      filters: []
    };

    if (child.left && child.left.field && !child.children || child.children.length == 0) {
      // 如果子节点有left、op和right, 则转换为graphql形式的filter,否则返回空字符串
      if (child.left && child.op && child.right) {
        var props = {
          field: child.left.field,
          operator: child.op,
          value: child.right
        };

        switch (props.operator) {
          case 'between':
            filterItem.operator = DynamicFilterOperator.Range;
            break;

          case 'select_any_in':
            filterItem.operator = DynamicFilterOperator.Any;
            break;

          case 'select_not_any_in':
            filterItem.operator = DynamicFilterOperator.NotAny;
            break;

          default:
            {
              //@ts-ignore
              var targetKey = (_b = props.operator) === null || _b === void 0 ? void 0 : _b.replaceAll("_", "").toLowerCase();

              for (var key in DynamicFilterOperator) {
                if (targetKey == key.toLowerCase()) {
                  //@ts-ignore
                  filterItem.operator = DynamicFilterOperator[key];
                  break;
                }
              }
            }
        }

        filterItem.field = props.field;
        filterItem.value = props.value;
      }
    } else if (child.children && child.children.length > 0) {
      // 如果有子节点, 则转换为graphql形式的filter
      filterItem.filters = convertToJSONFilter(child.children);
    }

    return filterItem;
  });
  return arr;
} //@ts-ignore


function dynamicJsonFilter(condition) {
  var _a;

  var dynamicFilter = {
    filters: []
  }; // 如果有子节点, 则转换为DynamicFilter形式的filter

  if (((_a = condition === null || condition === void 0 ? void 0 : condition.children) === null || _a === void 0 ? void 0 : _a.length) > 0) {
    var children = condition.children; // 利用递归将筛选转换为graphql形式的filter字符串

    var mapResult = convertToJSONFilter(children);
    if (mapResult) if ((mapResult === null || mapResult === void 0 ? void 0 : mapResult.length) > 1) {
      //@ts-ignore
      dynamicFilter.logic = condition.conjunction;
      dynamicFilter.filters = mapResult;
    } else {
      dynamicFilter = mapResult[0];
    }
  }

  return JSON.stringify(dynamicFilter); // return "{\"field\":\"address.city\",\"operator\":\"Eq\",\"value\":[]}"
}

function genGraphqlFilter(children) {
  console.log('genGraphqlFilter children: ', children);
  var arr = children.map(function (child) {
    if (child.left && child.left.field) {
      if (child.left && child.op && child.right) {
        var filter = {
          field: child.left.field,
          operator: "",
          value: child.right
        };

        switch (child.op) {
          case 'between':
            filter.operator = "RANGE";
            break;

          case 'select_any_in':
            filter.operator = "ANY";
            break;

          case 'select_not_any_in':
            filter.operator = "NOT_ANY";
            break;

          default:
            filter.operator = child.op;
            break;
        }

        var filterStringJoin = '';

        for (var item in filter) {
          if (filterStringJoin) {
            filterStringJoin = filterStringJoin + ",";
          }

          if (item === "field" || item === "value") {
            filterStringJoin = filterStringJoin + item + ':"' + filter[item] + '"';
          } else if (item === "operator") {
            filterStringJoin = filterStringJoin + item + ':' + filter[item];
          } else {
            console.error("filter[item]: ", filter, item);
            return "{}";
          }
        }

        return "{" + filterStringJoin + "}";
      } else {
        return "{}";
      }
    } else if (child.children && child.children.length > 0) {
      var genChilds = genGraphqlFilter(child.children);

      if (genChilds === "[]") {
        return "{}";
      } else {
        return "{" + "logic:" + child.conjunction + ",filters:" + genChilds + "}";
      }
    } else {
      return "{}";
    }
  }).filter(function (item) {
    return item !== "{}";
  });
  console.log('arr: ', arr);

  if (arr.length > 0) {
    return "[" + arr.join(",") + "]";
  } else {
    return "[]";
  } //return JSON.stringify(arr);

} //@ts-ignore


window.amisExt = {
  dynamicJsonFilter: dynamicJsonFilter,
  convertCondition: function convertCondition(condition) {
    console.log(condition, "convertCondition");
    var filterString = ""; // 如果有子节点, 则转换为graphql形式的filter

    if (condition && condition.children && condition.children.length > 0) {
      var children = condition.children;
      console.log('children: ', children); // 利用递归将筛选转换为graphql形式的filter字符串

      filterString = "{" + "logic:" + condition.conjunction + "," + "filters:" + genGraphqlFilter(children) + "}";
    }

    if (filterString) {
      return filterString;
    } else {
      return "{}";
    }
  }
};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkFtaXNFeHQudHMiLCJBbWlzRXh0LmpzIl0sIm5hbWVzIjpbIkR5bmFtaWNGaWx0ZXJPcGVyYXRvciIsIkR5bmFtaWNGaWx0ZXJMb2dpYyIsIkR5bmFtaWNGaWx0ZXJJbmZvIiwiZmlsdGVycyIsImNvbnZlcnRUb0pTT05GaWx0ZXIiLCJjb25kaXRpb24iLCJhcnIiLCJtYXAiLCJjaGlsZCIsIl9hIiwiX2IiLCJmaWx0ZXJJdGVtIiwibG9naWMiLCJjb25qdW5jdGlvbiIsIkFuZCIsImxlZnQiLCJmaWVsZCIsImNoaWxkcmVuIiwibGVuZ3RoIiwib3AiLCJyaWdodCIsInByb3BzIiwib3BlcmF0b3IiLCJ2YWx1ZSIsIlJhbmdlIiwiQW55IiwiTm90QW55IiwidGFyZ2V0S2V5IiwicmVwbGFjZUFsbCIsInRvTG93ZXJDYXNlIiwia2V5IiwiZHluYW1pY0pzb25GaWx0ZXIiLCJkeW5hbWljRmlsdGVyIiwibWFwUmVzdWx0IiwiSlNPTiIsInN0cmluZ2lmeSIsImdlbkdyYXBocWxGaWx0ZXIiLCJjb25zb2xlIiwibG9nIiwiZmlsdGVyIiwiZmlsdGVyU3RyaW5nSm9pbiIsIml0ZW0iLCJlcnJvciIsImdlbkNoaWxkcyIsImpvaW4iLCJ3aW5kb3ciLCJhbWlzRXh0IiwiY29udmVydENvbmRpdGlvbiIsImZpbHRlclN0cmluZyJdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxJQUFLQSxxQkFBTDs7QUFBQSxDQUFBLFVBQUtBLHFCQUFMLEVBQTBCO0VBQ3RCO0VBQ0E7RUFDQTtFQUNBQSxxQkFBQSxDQUFBLFVBQUEsQ0FBQSxHQUFBLFVBQUE7RUFDQUEscUJBQUEsQ0FBQSxZQUFBLENBQUEsR0FBQSxZQUFBO0VBQ0FBLHFCQUFBLENBQUEsVUFBQSxDQUFBLEdBQUEsVUFBQTtFQUNBQSxxQkFBQSxDQUFBLGFBQUEsQ0FBQSxHQUFBLGFBQUE7RUFDQUEscUJBQUEsQ0FBQSxlQUFBLENBQUEsR0FBQSxlQUFBO0VBQ0FBLHFCQUFBLENBQUEsYUFBQSxDQUFBLEdBQUEsYUFB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QSxJQUFJQSxHQUFHLENBQUNZLE1BQUosR0FBYSxDQUFqQixFQUFvQjtJQUNoQixPQUFPLE1BQU1aLEdBQUcsQ0FBQ3NDLElBQUosQ0FBUyxHQUFULENBQU4sR0FBc0IsR0FBN0I7RUFFSCxDQUhELE1BR087SUFDSCxPQUFPLElBQVA7RUFDSCxDQTVEa0MsQ0E2RG5DOztBQUNILEMsQ0FHRDs7O0FBQ0FDLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQjtFQUNiZixpQkFBaUIsRUFBQUEsaUJBREo7RUFFYmdCLGdCQUFnQixFQUFFLDBCQUFVMUMsU0FBVixFQUF3QjtJQUN0Q2dDLE9BQU8sQ0FBQ0MsR0FBUixDQUFZakMsU0FBWixFQUF1QixrQkFBdkI7SUFDQSxJQUFJMkMsWUFBWSxHQUFHLEVBQW5CLENBRnNDLENBR3RDOztJQUNBLElBQUkzQyxTQUFTLElBQUlBLFNBQVMsQ0FBQ1ksUUFBdkIsSUFBbUNaLFNBQVMsQ0FBQ1ksUUFBVixDQUFtQkMsTUFBbkIsR0FBNEIsQ0FBbkUsRUFBc0U7TUFDbEUsSUFBTUQsUUFBUSxHQUFHWixTQUFTLENBQUNZLFFBQTNCO01BQ0FvQixPQUFPLENBQUNDLEdBQVIsQ0FBWSxZQUFaLEVBQTBCckIsUUFBMUIsRUFGa0UsQ0FHbEU7O01BQ0ErQixZQUFZLEdBQUcsTUFBTSxRQUFOLEdBQWlCM0MsU0FBUyxDQUFDUSxXQUEzQixHQUF5QyxHQUF6QyxHQUErQyxVQUEvQyxHQUE0RHVCLGdCQUFnQixDQUFDbkIsUUFBRCxDQUE1RSxHQUF5RixHQUF4RztJQUNIOztJQUVELElBQUkrQixZQUFKLEVBQWtCO01BQ2QsT0FBT0EsWUFBUDtJQUVILENBSEQsTUFHTztNQUNILE9BQU8sSUFBUDtJQUNIO0VBQ0o7QUFuQlksQ0FBakIiLCJmaWxlIjoiQW1pc0V4dC5qcyIsInNvdXJjZXNDb250ZW50IjpbImVudW0gRHluYW1pY0ZpbHRlck9wZXJhdG9yIHtcclxuICAgIC8vLyA8c3VtbWFyeT5cclxuICAgIC8vLyBsaWtlXHJcbiAgICAvLy8gPC9zdW1tYXJ5PlxyXG4gICAgQ29udGFpbnMgPSBcIkNvbnRhaW5zXCIsXHJcbiAgICBTdGFydHNXaXRoID0gXCJTdGFydHNXaXRoXCIsXHJcbiAgICBFbmRzV2l0aCA9IFwiRW5kc1dpdGhcIixcclxuICAgIE5vdENvbnRhaW5zID0gXCJOb3RDb250YWluc1wiLFxyXG4gICAgTm90U3RhcnRzV2l0aCA9IFwiTm90U3RhcnRzV2l0aFwiLFxyXG4gICAgTm90RW5kc1dpdGggPSBcIk5vdEVuZHNXaXRoXCIsXHJcblxyXG4gICAgLy8vIDxzdW1tYXJ5PlxyXG4gICAgLy8vID08cGFyYT48L3BhcmE+XHJcbiAgICAvLy8gRXF1YWwvRXF1YWxzL0VxIOaViOaenOebuOWQjFxyXG4gICAgLy8vIDwvc3VtbWFyeT5cclxuICAgIEVxdWFsID0gXCJFcXVhbFwiLFxyXG4gICAgLy8vIDxzdW1tYXJ5PlxyXG4gICAgLy8vID08cGFyYT48L3BhcmE+XHJcbiAgICAvLy8gRXF1YWwvRXF1YWxzL0VxIOaViOaenOebuOWQjFxyXG4gICAgLy8vIDwvc3VtbWFyeT5cclxuICAgIEVxdWFscyA9IFwiRXF1YWxzXCIsXHJcbiAgICAvLy8gPHN1bW1hcnk+XHJcbiAgICAvLy8gPTxwYXJhPjwvcGFyYT5cclxuICAgIC8vLyBFcXVhbC9FcXVhbHMvRXEg5pWI5p6c55u45ZCMXHJcbiAgICAvLy8gPC9zdW1tYXJ5PlxyXG4gICAgRXEgPSBcIkVxXCIsXHJcbiAgICAvLy8gPHN1bW1hcnk+XHJcbiAgICAvLy8gJmx0OyZndDtcclxuICAgIC8vLyA8L3N1bW1hcnk+XHJcbiAgICBOb3RFcXVhbCA9IFwiTm90RXF1YWxcIixcclxuXHJcbiAgICAvLy8gPHN1bW1hcnk+XHJcbiAgICAvLy8gJmd0O1xyXG4gICAgLy8vIDwvc3VtbWFyeT5cclxuICAgIEdyZWF0ZXJUaGFuID0gXCJHcmVhdGVyVGhhblwiLFxyXG4gICAgLy8vIDxzdW1tYXJ5PlxyXG4gICAgLy8vICZndDs9XHJcbiAgICAvLy8gPC9zdW1tYXJ5PlxyXG4gICAgR3JlYXRlclRoYW5PckVxdWFsID0gXCJHcmVhdGVyVGhhbk9yRXF1YWxcIixcclxuICAgIC8vLyA8c3VtbWFyeT5cclxuICAgIC8vLyAmbHQ7XHJcbiAgICAvLy8gPC9zdW1tYXJ5PlxyXG4gICAgTGVzc1RoYW4gPSBcIkxlc3NUaGFuXCIsXHJcbiAgICAvLy8gPHN1bW1hcnk+XHJcbiAgICAvLy8gJmx0Oz1cclxuICAgIC8vLyA8L3N1bW1hcnk+XHJcbiAgICBMZXNzVGhhbk9yRXF1YWwgPSBcIkxlc3NUaGFuT3JFcXVhbFwiLFxyXG5cclxuICAgIC8vLyA8c3VtbWFyeT5cclxuICAgIC8vLyAmZ3Q7PSBhbmQgJmx0OzxwYXJhPjwvcGFyYT5cclxuICAgIC8vLyDmraTml7YgVmFsdWUg55qE5YC85qC85byP5Li66YCX5Y+35YiG5Ymy77yadmFsdWUxLHZhbHVlMiDmiJbogIXmlbDnu4RcclxuICAgIC8vLyA8L3N1bW1hcnk+XHJcbiAgICBSYW5nZSA9IFwiUmFuZ2VcIixcclxuXHJcbiAgICAvLy8gPHN1bW1hcnk+XHJcbiAgICAvLy8gJmd0Oz0gYW5kICZsdDs8cGFyYT48L3BhcmE+XHJcbiAgICAvLy8g5q2k5pe2IFZhbHVlIOeahOWAvOagvOW8j+S4uumAl+WPt+WIhuWJsu+8mmRhdGUxLGRhdGUyIOaIluiAheaVsOe7hDxwYXJhPjwvcGFyYT5cclxuICAgIC8vLyDov5nmmK/kuJPpl6jkuLrml6XmnJ/ojIPlm7Tmn6Xor6LlrprliLbnmoTmk43kvZznrKbvvIzlroPkvJrlpITnkIYgZGF0ZTIgKyAx77yM5q+U5aaC77yaPHBhcmE+PC9wYXJhPlxyXG4gICAgLy8vIOW9kyBkYXRlMiDpgInmi6nnmoTmmK8gMjAyMC0wNS0zMO+8jOmCo+afpeivoueahOaXtuWAmeaYryAmbHQ7IDIwMjAtMDUtMzE8cGFyYT48L3BhcmE+XHJcbiAgICAvLy8g5b2TIGRhdGUyIOmAieaLqeeahOaYryAyMDIwLTA177yM6YKj5p+l6K+i55qE5pe25YCZ5pivICZsdDsgMjAyMC0wNjxwYXJhPjwvcGFyYT5cclxuICAgIC8vLyDlvZMgZGF0ZTIg6YCJ5oup55qE5pivIDIwMjDvvIzpgqPmn6Xor6LnmoTml7blgJnmmK8gJmx0OyAyMDIxPHBhcmE+PC9wYXJhPlxyXG4gICAgLy8vIOW9kyBkYXRlMiDpgInmi6nnmoTmmK8gMjAyMC0wNS0zMCAxMu+8jOmCo+afpeivoueahOaXtuWAmeaYryAmbHQ7IDIwMjAtMDUtMzAgMTM8cGFyYT48L3BhcmE+XHJcbiAgICAvLy8g5b2TIGRhdGUyIOmAieaLqeeahOaYryAyMDIwLTA1LTMwIDEyOjMw77yM6YKj5p+l6K+i55qE5pe25YCZ5pivICZsdDsgMjAyMC0wNS0zMCAxMjozMTxwYXJhPjwvcGFyYT5cclxuICAgIC8vLyDlubbkuJQgZGF0ZTIg5Y+q5pSv5oyB5Lul5LiKIDUg56eN5qC85byPIChkYXRlMSDmsqHmnInpmZDliLYpXHJcbiAgICAvLy8gPC9zdW1tYXJ5PlxyXG4gICAgRGF0ZVJhbmdlID0gXCJEYXRlUmFuZ2VcIixcclxuICAgIC8vLyA8c3VtbWFyeT5cclxuICAgIC8vLyBpbiAoMSwyLDMpPHBhcmE+PC9wYXJhPlxyXG4gICAgLy8vIOatpOaXtiBWYWx1ZSDnmoTlgLzmoLzlvI/kuLrpgJflj7fliIblibLvvJp2YWx1ZTEsdmFsdWUyLHZhbHVlMy4uLiDmiJbogIXmlbDnu4RcclxuICAgIC8vLyA8L3N1bW1hcnk+XHJcbiAgICBBbnkgPSBcIkFueVwiLFxyXG4gICAgLy8vIDxzdW1tYXJ5PlxyXG4gICAgLy8vIG5vdCBpbiAoMSwyLDMpPHBhcmE+PC9wYXJhPlxyXG4gICAgLy8vIOatpOaXtiBWYWx1ZSDnmoTlgLzmoLzlvI/kuLrpgJflj7fliIblibLvvJp2YWx1ZTEsdmFsdWUyLHZhbHVlMy4uLiDmiJbogIXmlbDnu4RcclxuICAgIC8vLyA8L3N1bW1hcnk+XHJcbiAgICBOb3RBbnkgPSBcIk5vdEFueVwiLFxyXG5cclxuICAgIC8vLyA8c3VtbWFyeT5cclxuICAgIC8vLyDoh6rlrprkuYnop6PmnpDvvIzmraTml7YgRmllbGQg5Li65Y+N5bCE5L+h5oGv77yMVmFsdWUg5Li66Z2Z5oCB5pa55rOV55qE5Y+C5pWwKHN0cmluZyk8cGFyYT48L3BhcmE+XHJcbiAgICAvLy8g56S66IyD77yaeyBPcGVyYXRvcjogXCJDdXN0b21cIiwgRmllbGQ6IFwiUmF3U3FsIHdlYmFwcDEuRHluYW1pY0ZpbHRlckN1c3RvbSx3ZWJhcHAxXCIsIFZhbHVlOiBcIihpZCxuYW1lKSBpbiAoKDEsJ2snKSwoMiwnbScpKVwiIH08cGFyYT48L3BhcmE+XHJcbiAgICAvLy8g5rOo5oSP77ya5L2/55So6ICF6Ieq5bex5om/5ouF44CQ5rOo5YWl6aOO6Zmp44CRPHBhcmE+PC9wYXJhPlxyXG4gICAgLy8vIOmdmeaAgeaWueazleWumuS5ieekuuiMg++8mjxwYXJhPjwvcGFyYT5cclxuICAgIC8vLyBuYW1lc3BhY2Ugd2ViYXBwMTxwYXJhPjwvcGFyYT5cclxuICAgIC8vLyB7PHBhcmE+PC9wYXJhPlxyXG4gICAgLy8vIHB1YmxpYyBjbGFzcyBEeW5hbWljRmlsdGVyQ3VzdG9tPHBhcmE+PC9wYXJhPlxyXG4gICAgLy8vIHs8cGFyYT48L3BhcmE+XHJcbiAgICAvLy8gW0R5bmFtaWNGaWx0ZXJDdXN0b21dPHBhcmE+PC9wYXJhPlxyXG4gICAgLy8vIHB1YmxpYyBzdGF0aWMgc3RyaW5nIFJhd1NxbChvYmplY3Qgc2VuZGVyLCBzdHJpbmcgdmFsdWUpID0+IHZhbHVlOzxwYXJhPjwvcGFyYT5cclxuICAgIC8vLyB9PHBhcmE+PC9wYXJhPlxyXG4gICAgLy8vIH08cGFyYT48L3BhcmE+XHJcbiAgICAvLy8gPC9zdW1tYXJ5PlxyXG4gICAgLy8gQ3VzdG9tXHJcbn1cclxuXHJcbmVudW0gRHluYW1pY0ZpbHRlckxvZ2ljIHsgQW5kID0gXCJBbmRcIiwgT3IgPSBcIk9yXCIgfVxyXG5cclxuY2xhc3MgRHluYW1pY0ZpbHRlckluZm8ge1xyXG4gICAgZmllbGQ/OiBzdHJpbmdcclxuICAgIG9wZXJhdG9yPzogRHluYW1pY0ZpbHRlck9wZXJhdG9yXHJcbiAgICB2YWx1ZT86IGFueVxyXG4gICAgbG9naWM/OiBEeW5hbWljRmlsdGVyTG9naWNcclxuICAgIGZpbHRlcnM/OiBEeW5hbWljRmlsdGVySW5mb1tdID0gW11cclxufVxyXG5cclxuZnVuY3Rpb24gY29udmVydFRvSlNPTkZpbHRlcihjb25kaXRpb246IGFueSk6IER5bmFtaWNGaWx0ZXJJbmZvW10ge1xyXG4gICAgY29uc3QgYXJyOiBEeW5hbWljRmlsdGVySW5mb1tdID0gY29uZGl0aW9uLm1hcCgoY2hpbGQ6IGFueSkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGZpbHRlckl0ZW0gPSB7XHJcbiAgICAgICAgICAgIGxvZ2ljOiBjaGlsZC5jb25qdW5jdGlvbiA/PyBEeW5hbWljRmlsdGVyTG9naWMuQW5kLFxyXG4gICAgICAgICAgICBmaWx0ZXJzOiBbXVxyXG4gICAgICAgIH0gYXMgRHluYW1pY0ZpbHRlckluZm9cclxuICAgICAgICBpZiAoY2hpbGQubGVmdCAmJiBjaGlsZC5sZWZ0LmZpZWxkICYmICFjaGlsZC5jaGlsZHJlbiB8fCBjaGlsZC5jaGlsZHJlbi5sZW5ndGggPT0gMCkge1xyXG4gICAgICAgICAgICAvLyDlpoLmnpzlrZDoioLngrnmnIlsZWZ044CBb3DlkoxyaWdodCwg5YiZ6L2s5o2i5Li6Z3JhcGhxbOW9ouW8j+eahGZpbHRlcizlkKbliJnov5Tlm57nqbrlrZfnrKbkuLJcclxuICAgICAgICAgICAgaWYgKGNoaWxkLmxlZnQgJiYgY2hpbGQub3AgJiYgY2hpbGQucmlnaHQpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHByb3BzID0ge2ZpZWxkOiBjaGlsZC5sZWZ0LmZpZWxkLCBvcGVyYXRvcjogY2hpbGQub3AsIHZhbHVlOiBjaGlsZC5yaWdodH07XHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHByb3BzLm9wZXJhdG9yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnYmV0d2Vlbic6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlckl0ZW0ub3BlcmF0b3IgPSBEeW5hbWljRmlsdGVyT3BlcmF0b3IuUmFuZ2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdzZWxlY3RfYW55X2luJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVySXRlbS5vcGVyYXRvciA9IER5bmFtaWNGaWx0ZXJPcGVyYXRvci5BbnlcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdzZWxlY3Rfbm90X2FueV9pbic6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlckl0ZW0ub3BlcmF0b3IgPSBEeW5hbWljRmlsdGVyT3BlcmF0b3IuTm90QW55XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrXHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDoge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL0B0cy1pZ25vcmVcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0S2V5ID0gcHJvcHMub3BlcmF0b3I/LnJlcGxhY2VBbGwoXCJfXCIsIFwiXCIpLnRvTG93ZXJDYXNlKCkgYXMgc3RyaW5nXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3Qga2V5IGluIER5bmFtaWNGaWx0ZXJPcGVyYXRvcikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldEtleSA9PSAoa2V5LnRvTG93ZXJDYXNlKCkpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9AdHMtaWdub3JlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVySXRlbS5vcGVyYXRvciA9IER5bmFtaWNGaWx0ZXJPcGVyYXRvcltrZXldXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGZpbHRlckl0ZW0uZmllbGQgPSBwcm9wcy5maWVsZDtcclxuICAgICAgICAgICAgICAgIGZpbHRlckl0ZW0udmFsdWUgPSBwcm9wcy52YWx1ZTtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9IGVsc2UgaWYgKGNoaWxkLmNoaWxkcmVuICYmIGNoaWxkLmNoaWxkcmVuLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgLy8g5aaC5p6c5pyJ5a2Q6IqC54K5LCDliJnovazmjaLkuLpncmFwaHFs5b2i5byP55qEZmlsdGVyXHJcbiAgICAgICAgICAgIGZpbHRlckl0ZW0uZmlsdGVycyA9IGNvbnZlcnRUb0pTT05GaWx0ZXIoY2hpbGQuY2hpbGRyZW4pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmlsdGVySXRlbVxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gYXJyXHJcbn1cclxuXHJcblxyXG4vL0B0cy1pZ25vcmVcclxuZnVuY3Rpb24gZHluYW1pY0pzb25GaWx0ZXIoY29uZGl0aW9uOiBhbnkpIHtcclxuXHJcbiAgICBsZXQgZHluYW1pY0ZpbHRlciA9IHtcclxuICAgICAgICBmaWx0ZXJzOiBbXVxyXG4gICAgfSBhcyBEeW5hbWljRmlsdGVySW5mbztcclxuICAgIC8vIOWmguaenOacieWtkOiKgueCuSwg5YiZ6L2s5o2i5Li6RHluYW1pY0ZpbHRlcuW9ouW8j+eahGZpbHRlclxyXG4gICAgaWYgKGNvbmRpdGlvbj8uY2hpbGRyZW4/Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICBjb25zdCBjaGlsZHJlbiA9IGNvbmRpdGlvbi5jaGlsZHJlbjtcclxuICAgICAgICAvLyDliKnnlKjpgJLlvZLlsIbnrZvpgInovazmjaLkuLpncmFwaHFs5b2i5byP55qEZmlsdGVy5a2X56ym5LiyXHJcbiAgICAgICAgY29uc3QgbWFwUmVzdWx0ID0gY29udmVydFRvSlNPTkZpbHRlcihjaGlsZHJlbik7XHJcbiAgICAgICAgaWYgKG1hcFJlc3VsdClcclxuICAgICAgICAgICAgaWYgKG1hcFJlc3VsdD8ubGVuZ3RoID4gMSkge1xyXG4gICAgICAgICAgICAgICAgLy9AdHMtaWdub3JlXHJcbiAgICAgICAgICAgICAgICBkeW5hbWljRmlsdGVyLmxvZ2ljID0gY29uZGl0aW9uLmNvbmp1bmN0aW9uO1xyXG4gICAgICAgICAgICAgICAgZHluYW1pY0ZpbHRlci5maWx0ZXJzID0gbWFwUmVzdWx0O1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZHluYW1pY0ZpbHRlciA9IG1hcFJlc3VsdFswXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShkeW5hbWljRmlsdGVyKVxyXG5cclxuICAgIC8vIHJldHVybiBcIntcXFwiZmllbGRcXFwiOlxcXCJhZGRyZXNzLmNpdHlcXFwiLFxcXCJvcGVyYXRvclxcXCI6XFxcIkVxXFxcIixcXFwidmFsdWVcXFwiOltdfVwiXHJcbn1cclxuXHJcblxyXG5mdW5jdGlvbiBnZW5HcmFwaHFsRmlsdGVyKGNoaWxkcmVuOiBhbnkpIHtcclxuICAgIGNvbnNvbGUubG9nKCdnZW5HcmFwaHFsRmlsdGVyIGNoaWxkcmVuOiAnLCBjaGlsZHJlbik7XHJcbiAgICBjb25zdCBhcnIgPSBjaGlsZHJlbi5tYXAoKGNoaWxkOiBhbnkpID0+IHtcclxuICAgICAgICBpZiAoY2hpbGQubGVmdCAmJiBjaGlsZC5sZWZ0LmZpZWxkKSB7XHJcbiAgICAgICAgICAgIGlmIChjaGlsZC5sZWZ0ICYmIGNoaWxkLm9wICYmIGNoaWxkLnJpZ2h0KSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBmaWx0ZXIgPSB7ZmllbGQ6IGNoaWxkLmxlZnQuZmllbGQsIG9wZXJhdG9yOiBcIlwiLCB2YWx1ZTogY2hpbGQucmlnaHR9O1xyXG5cclxuICAgICAgICAgICAgICAgIHN3aXRjaCAoY2hpbGQub3ApIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdiZXR3ZWVuJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyLm9wZXJhdG9yID0gXCJSQU5HRVwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrXHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnc2VsZWN0X2FueV9pbic6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlci5vcGVyYXRvciA9IFwiQU5ZXCJcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWtcclxuICAgICAgICAgICAgICAgICAgICBjYXNlICdzZWxlY3Rfbm90X2FueV9pbic6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlci5vcGVyYXRvciA9IFwiTk9UX0FOWVwiXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrXHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyLm9wZXJhdG9yID0gY2hpbGQub3BcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBsZXQgZmlsdGVyU3RyaW5nSm9pbiA9ICcnO1xyXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBpdGVtIGluIGZpbHRlcikge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJTdHJpbmdKb2luKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlclN0cmluZ0pvaW4gPSBmaWx0ZXJTdHJpbmdKb2luICsgXCIsXCJcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0gPT09IFwiZmllbGRcIiB8fCBpdGVtID09PSBcInZhbHVlXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyU3RyaW5nSm9pbiA9IGZpbHRlclN0cmluZ0pvaW4gKyBpdGVtICsgJzpcIicgKyBmaWx0ZXJbaXRlbV0gKyAnXCInXHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpdGVtID09PSBcIm9wZXJhdG9yXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZmlsdGVyU3RyaW5nSm9pbiA9IGZpbHRlclN0cmluZ0pvaW4gKyBpdGVtICsgJzonICsgZmlsdGVyW2l0ZW1dXHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcImZpbHRlcltpdGVtXTogXCIsIGZpbHRlciwgaXRlbSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwie31cIjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIHJldHVybiBcIntcIiArIGZpbHRlclN0cmluZ0pvaW4gKyBcIn1cIjtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBcInt9XCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2UgaWYgKGNoaWxkLmNoaWxkcmVuICYmIGNoaWxkLmNoaWxkcmVuLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgY29uc3QgZ2VuQ2hpbGRzID0gZ2VuR3JhcGhxbEZpbHRlcihjaGlsZC5jaGlsZHJlbilcclxuICAgICAgICAgICAgaWYgKGdlbkNoaWxkcyA9PT0gXCJbXVwiKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJ7fVwiXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJ7XCIgKyBcImxvZ2ljOlwiICsgY2hpbGQuY29uanVuY3Rpb24gKyBcIixmaWx0ZXJzOlwiICsgZ2VuQ2hpbGRzICsgXCJ9XCI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICByZXR1cm4gXCJ7fVwiO1xyXG4gICAgICAgIH1cclxuICAgIH0pLmZpbHRlcigoaXRlbTogYW55KSA9PiBpdGVtICE9PSBcInt9XCIpO1xyXG5cclxuICAgIGNvbnNvbGUubG9nKCdhcnI6ICcsIGFycik7XHJcbiAgICBpZiAoYXJyLmxlbmd0aCA+IDApIHtcclxuICAgICAgICByZXR1cm4gXCJbXCIgKyBhcnIuam9pbihcIixcIikgKyBcIl1cIjtcclxuXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIHJldHVybiBcIltdXCI7XHJcbiAgICB9XHJcbiAgICAvL3JldHVybiBKU09OLnN0cmluZ2lmeShhcnIpO1xyXG59XHJcblxyXG5cclxuLy9AdHMtaWdub3JlXHJcbndpbmRvdy5hbWlzRXh0ID0ge1xyXG4gICAgZHluYW1pY0pzb25GaWx0ZXIsXHJcbiAgICBjb252ZXJ0Q29uZGl0aW9uOiBmdW5jdGlvbiAoY29uZGl0aW9uOiBhbnkpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhjb25kaXRpb24sIFwiY29udmVydENvbmRpdGlvblwiKVxyXG4gICAgICAgIGxldCBmaWx0ZXJTdHJpbmcgPSBcIlwiO1xyXG4gICAgICAgIC8vIOWmguaenOacieWtkOiKgueCuSwg5YiZ6L2s5o2i5Li6Z3JhcGhxbOW9ouW8j+eahGZpbHRlclxyXG4gICAgICAgIGlmIChjb25kaXRpb24gJiYgY29uZGl0aW9uLmNoaWxkcmVuICYmIGNvbmRpdGlvbi5jaGlsZHJlbi5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNoaWxkcmVuID0gY29uZGl0aW9uLmNoaWxkcmVuO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnY2hpbGRyZW46ICcsIGNoaWxkcmVuKTtcclxuICAgICAgICAgICAgLy8g5Yip55So6YCS5b2S5bCG562b6YCJ6L2s5o2i5Li6Z3JhcGhxbOW9ouW8j+eahGZpbHRlcuWtl+espuS4slxyXG4gICAgICAgICAgICBmaWx0ZXJTdHJpbmcgPSBcIntcIiArIFwibG9naWM6XCIgKyBjb25kaXRpb24uY29uanVuY3Rpb24gKyBcIixcIiArIFwiZmlsdGVyczpcIiArIGdlbkdyYXBocWxGaWx0ZXIoY2hpbGRyZW4pICsgXCJ9XCI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoZmlsdGVyU3RyaW5nKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBmaWx0ZXJTdHJpbmc7XHJcblxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBcInt9XCI7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcbiIsInZhciBEeW5hbWljRmlsdGVyT3BlcmF0b3I7XG4oZnVuY3Rpb24gKER5bmFtaWNGaWx0ZXJPcGVyYXRvcikge1xuICAgIC8vLyA8c3VtbWFyeT5cbiAgICAvLy8gbGlrZVxuICAgIC8vLyA8L3N1bW1hcnk+XG4gICAgRHluYW1pY0ZpbHRlck9wZXJhdG9yW1wiQ29udGFpbnNcIl0gPSBcIkNvbnRhaW5zXCI7XG4gICAgRHluYW1pY0ZpbHRlck9wZXJhdG9yW1wiU3RhcnRzV2l0aFwiXSA9IFwiU3RhcnRzV2l0aFwiO1xuICAgIER5bmFtaWNGaWx0ZXJPcGVyYXRvcltcIkVuZHNXaXRoXCJdID0gXCJFbmRzV2l0aFwiO1xuICAgIER5bmFtaWNGaWx0ZXJPcGVyYXRvcltcIk5vdENvbnRhaW5zXCJdID0gXCJOb3RDb250YWluc1wiO1xuICAgIER5bmFtaWNGaWx0ZXJPcGVyYXRvcltcIk5vdFN0YXJ0c1dpdGhcIl0gPSBcIk5vdFN0YXJ0c1dpdGhcIjtcbiAgICBEeW5hbWljRmlsdGVyT3BlcmF0b3JbXCJOb3RFbmRzV2l0aFwiXSA9IFwiTm90RW5kc1dpdGhcIjtcbiAgICAvLy8gPHN1bW1hcnk+XG4gICAgLy8vID08cGFyYT48L3BhcmE+XG4gICAgLy8vIEVxdWFsL0VxdWFscy9FcSDmlYjmnpznm7jlkIxcbiAgICAvLy8gPC9zdW1tYXJ5PlxuICAgIER5bmFtaWNGaWx0ZXJPcGVyYXRvcltcIkVxdWFsXCJdID0gXCJFcXVhbFwiO1xuICAgIC8vLyA8c3VtbWFyeT5cbiAgICAvLy8gPTxwYXJhPjwvcGFyYT5cbiAgICAvLy8gRXF1YWwvRXF1YWxzL0VxIOaViOaenOebuOWQjFxuICAgIC8vLyA8L3N1bW1hcnk+XG4gICAgRHluYW1pY0ZpbHRlck9wZXJhdG9yW1wiRXF1YWxzXCJdID0gXCJFcXVhbHNcIjtcbiAgICAvLy8gPHN1bW1hcnk+XG4gICAgLy8vID08cGFyYT48L3BhcmE+XG4gICAgLy8vIEVxdWFsL0VxdWFscy9FcSDmlYjmnpznm7jlkIxcbiAgICAvLy8gPC9zdW1tYXJ5PlxuICAgIER5bmFtaWNGaWx0ZXJPcGVyYXRvcltcIkVxXCJdID0gXCJFcVwiO1xuICAgIC8vLyA8c3VtbWFyeT5cbiAgICAvLy8gJmx0OyZndDtcbiAgICAvLy8gPC9zdW1tYXJ5PlxuICAgIER5bmFtaWNGaWx0ZXJPcGVyYXRvcltcIk5vdEVxdWFsXCJdID0gXCJOb3RFcXVhbFwiO1xuICAgIC8vLyA8c3VtbWFyeT5cbiAgICAvLy8gJmd0O1xuICAgIC8vLyA8L3N1bW1hcnk+XG4gICAgRHluYW1pY0ZpbHRlck9wZXJhdG9yW1wiR3JlYXRlclRoYW5cIl0gPSBcIkdyZWF0ZXJUaGFuXCI7XG4gICAgLy8vIDxzdW1tYXJ5PlxuICAgIC8vLyAmZ3Q7PVxuICAgIC8vLyA8L3N1bW1hcnk+XG4gICAgRHluYW1pY0ZpbHRlck9wZXJhdG9yW1wiR3JlYXRlclRoYW5PckVxdWFsXCJdID0gXCJHcmVhdGVyVGhhbk9yRXF1YWxcIjtcbiAgICAvLy8gPHN1bW1hcnk+XG4gICAgLy8vICZsdDtcbiAgICAvLy8gPC9zdW1tYXJ5PlxuICAgIER5bmFtaWNGaWx0ZXJPcGVyYXRvcltcIkxlc3NUaGFuXCJdID0gXCJMZXNzVGhhblwiO1xuICAgIC8vLyA8c3VtbWFyeT5cbiAgICAvLy8gJmx0Oz1cbiAgICAvLy8gPC9zdW1tYXJ5PlxuICAgIER5bmFtaWNGaWx0ZXJPcGVyYXRvcltcIkxlc3NUaGFuT3JFcXVhbFwiXSA9IFwiTGVzc1RoYW5PckVxdWFsXCI7XG4gICAgLy8vIDxzdW1tYXJ5PlxuICAgIC8vLyAmZ3Q7PSBhbmQgJmx0OzxwYXJhPjwvcGFyYT5cbiAgICAvLy8g5q2k5pe2IFZhbHVlIOeahOWAvOagvOW8j+S4uumAl+WPt+WIhuWJsu+8mnZhbHVlMSx2YWx1ZTIg5oiW6ICF5pWw57uEXG4gICAgLy8vIDwvc3VtbWFyeT5cbiAgICBEeW5hbWljRmlsdGVyT3BlcmF0b3JbXCJSYW5nZVwiXSA9IFwiUmFuZ2VcIjtcbiAgICAvLy8gPHN1bW1hcnk+XG4gICAgLy8vICZndDs9IGFuZCAmbHQ7PHBhcmE+PC9wYXJhPlxuICAgIC8vLyDmraTml7YgVmFsdWUg55qE5YC85qC85byP5Li66YCX5Y+35YiG5Ymy77yaZGF0ZTEsZGF0ZTIg5oiW6ICF5pWw57uEPHBhcmE+PC9wYXJhPlxuICAgIC8vLyDov5nmmK/kuJPpl6jkuLrml6XmnJ/ojIPlm7Tmn6Xor6LlrprliLbnmoTmk43kvZznrKbvvIzlroPkvJrlpITnkIYgZGF0ZTIgKyAx77yM5q+U5aaC77yaPHBhcmE+PC9wYXJhPlxuICAgIC8vLyDlvZMgZGF0ZTIg6YCJ5oup55qE5pivIDIwMjAtMDUtMzDvvIzpgqPmn6Xor6LnmoTml7blgJnmmK8gJmx0OyAyMDIwLTA1LTMxPHBhcmE+PC9wYXJhPlxuICAgIC8vLyDlvZMgZGF0ZTIg6YCJ5oup55qE5pivIDIwMjAtMDXvvIzpgqPmn6Xor6LnmoTml7blgJnmmK8gJmx0OyAyMDIwLTA2PHBhcmE+PC9wYXJhPlxuICAgIC8vLyDlvZMgZGF0ZTIg6YCJ5oup55qE5pivIDIwMjDvvIzpgqPmn6Xor6LnmoTml7blgJnmmK8gJmx0OyAyMDIxPHBhcmE+PC9wYXJhPlxuICAgIC8vLyDlvZMgZGF0ZTIg6YCJ5oup55qE5pivIDIwMjAtMDUtMzAgMTLvvIzpgqPmn6Xor6LnmoTml7blgJnmmK8gJmx0OyAyMDIwLTA1LTMwIDEzPHBhcmE+PC9wYXJhPlxuICAgIC8vLyDlvZMgZGF0ZTIg6YCJ5oup55qE5pivIDIwMjAtMDUtMzAgMTI6MzDvvIzpgqPmn6Xor6LnmoTml7blgJnmmK8gJmx0OyAyMDIwLTA1LTMwIDEyOjMxPHBhcmE+PC9wYXJhPlxuICAgIC8vLyDlubbkuJQgZGF0ZTIg5Y+q5pSv5oyB5Lul5LiKIDUg56eN5qC85byPIChkYXRlMSDmsqHmnInpmZDliLYpXG4gICAgLy8vIDwvc3VtbWFyeT5cbiAgICBEeW5hbWljRmlsdGVyT3BlcmF0b3JbXCJEYXRlUmFuZ2VcIl0gPSBcIkRhdGVSYW5nZVwiO1xuICAgIC8vLyA8c3VtbWFyeT5cbiAgICAvLy8gaW4gKDEsMiwzKTxwYXJhPjwvcGFyYT5cbiAgICAvLy8g5q2k5pe2IFZhbHVlIOeahOWAvOagvOW8j+S4uumAl+WPt+WIhuWJsu+8mnZhbHVlMSx2YWx1ZTIsdmFsdWUzLi4uIOaIluiAheaVsOe7hFxuICAgIC8vLyA8L3N1bW1hcnk+XG4gICAgRHluYW1pY0ZpbHRlck9wZXJhdG9yW1wiQW55XCJdID0gXCJBbnlcIjtcbiAgICAvLy8gPHN1bW1hcnk+XG4gICAgLy8vIG5vdCBpbiAoMSwyLDMpPHBhcmE+PC9wYXJhPlxuICAgIC8vLyDmraTml7YgVmFsdWUg55qE5YC85qC85byP5Li66YCX5Y+35YiG5Ymy77yadmFsdWUxLHZhbHVlMix2YWx1ZTMuLi4g5oiW6ICF5pWw57uEXG4gICAgLy8vIDwvc3VtbWFyeT5cbiAgICBEeW5hbWljRmlsdGVyT3BlcmF0b3JbXCJOb3RBbnlcIl0gPSBcIk5vdEFueVwiO1xuICAgIC8vLyA8c3VtbWFyeT5cbiAgICAvLy8g6Ieq5a6a5LmJ6Kej5p6Q77yM5q2k5pe2IEZpZWxkIOS4uuWPjeWwhOS/oeaBr++8jFZhbHVlIOS4uumdmeaAgeaWueazleeahOWPguaVsChzdHJpbmcpPHBhcmE+PC9wYXJhPlxuICAgIC8vLyDnpLrojIPvvJp7IE9wZXJhdG9yOiBcIkN1c3RvbVwiLCBGaWVsZDogXCJSYXdTcWwgd2ViYXBwMS5EeW5hbWljRmlsdGVyQ3VzdG9tLHdlYmFwcDFcIiwgVmFsdWU6IFwiKGlkLG5hbWUpIGluICgoMSwnaycpLCgyLCdtJykpXCIgfTxwYXJhPjwvcGFyYT5cbiAgICAvLy8g5rOo5oSP77ya5L2/55So6ICF6Ieq5bex5om/5ouF44CQ5rOo5YWl6aOO6Zmp44CRPHBhcmE+PC9wYXJhPlxuICAgIC8vLyDpnZnmgIHmlrnms5XlrprkuYnnpLrojIPvvJo8cGFyYT48L3BhcmE+XG4gICAgLy8vIG5hbWVzcGFjZSB3ZWJhcHAxPHBhcmE+PC9wYXJhPlxuICAgIC8vLyB7PHBhcmE+PC9wYXJhPlxuICAgIC8vLyBwdWJsaWMgY2xhc3MgRHluYW1pY0ZpbHRlckN1c3RvbTxwYXJhPjwvcGFyYT5cbiAgICAvLy8gezxwYXJhPjwvcGFyYT5cbiAgICAvLy8gW0R5bmFtaWNGaWx0ZXJDdXN0b21dPHBhcmE+PC9wYXJhPlxuICAgIC8vLyBwdWJsaWMgc3RhdGljIHN0cmluZyBSYXdTcWwob2JqZWN0IHNlbmRlciwgc3RyaW5nIHZhbHVlKSA9PiB2YWx1ZTs8cGFyYT48L3BhcmE+XG4gICAgLy8vIH08cGFyYT48L3BhcmE+XG4gICAgLy8vIH08cGFyYT48L3BhcmE+XG4gICAgLy8vIDwvc3VtbWFyeT5cbiAgICAvLyBDdXN0b21cbn0pKER5bmFtaWNGaWx0ZXJPcGVyYXRvciB8fCAoRHluYW1pY0ZpbHRlck9wZXJhdG9yID0ge30pKTtcbnZhciBEeW5hbWljRmlsdGVyTG9naWM7XG4oZnVuY3Rpb24gKER5bmFtaWNGaWx0ZXJMb2dpYykge1xuICAgIER5bmFtaWNGaWx0ZXJMb2dpY1tcIkFuZFwiXSA9IFwiQW5kXCI7XG4gICAgRHluYW1pY0ZpbHRlckxvZ2ljW1wiT3JcIl0gPSBcIk9yXCI7XG59KShEeW5hbWljRmlsdGVyTG9naWMgfHwgKER5bmFtaWNGaWx0ZXJMb2dpYyA9IHt9KSk7XG52YXIgRHluYW1pY0ZpbHRlckluZm8gPSAvKiogQGNsYXNzICovIChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gRHluYW1pY0ZpbHRlckluZm8oKSB7XG4gICAgICAgIHRoaXMuZmlsdGVycyA9IFtdO1xuICAgIH1cbiAgICByZXR1cm4gRHluYW1pY0ZpbHRlckluZm87XG59KCkpO1xuZnVuY3Rpb24gY29udmVydFRvSlNPTkZpbHRlcihjb25kaXRpb24pIHtcbiAgICB2YXIgYXJyID0gY29uZGl0aW9uLm1hcChmdW5jdGlvbiAoY2hpbGQpIHtcbiAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgdmFyIGZpbHRlckl0ZW0gPSB7XG4gICAgICAgICAgICBsb2dpYzogKF9hID0gY2hpbGQuY29uanVuY3Rpb24pICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IER5bmFtaWNGaWx0ZXJMb2dpYy5BbmQsXG4gICAgICAgICAgICBmaWx0ZXJzOiBbXVxuICAgICAgICB9O1xuICAgICAgICBpZiAoY2hpbGQubGVmdCAmJiBjaGlsZC5sZWZ0LmZpZWxkICYmICFjaGlsZC5jaGlsZHJlbiB8fCBjaGlsZC5jaGlsZHJlbi5sZW5ndGggPT0gMCkge1xuICAgICAgICAgICAgLy8g5aaC5p6c5a2Q6IqC54K55pyJbGVmdOOAgW9w5ZKMcmlnaHQsIOWImei9rOaNouS4umdyYXBocWzlvaLlvI/nmoRmaWx0ZXIs5ZCm5YiZ6L+U5Zue56m65a2X56ym5LiyXG4gICAgICAgICAgICBpZiAoY2hpbGQubGVmdCAmJiBjaGlsZC5vcCAmJiBjaGlsZC5yaWdodCkge1xuICAgICAgICAgICAgICAgIHZhciBwcm9wcyA9IHsgZmllbGQ6IGNoaWxkLmxlZnQuZmllbGQsIG9wZXJhdG9yOiBjaGlsZC5vcCwgdmFsdWU6IGNoaWxkLnJpZ2h0IH07XG4gICAgICAgICAgICAgICAgc3dpdGNoIChwcm9wcy5vcGVyYXRvcikge1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdiZXR3ZWVuJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlckl0ZW0ub3BlcmF0b3IgPSBEeW5hbWljRmlsdGVyT3BlcmF0b3IuUmFuZ2U7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnc2VsZWN0X2FueV9pbic6XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJJdGVtLm9wZXJhdG9yID0gRHluYW1pY0ZpbHRlck9wZXJhdG9yLkFueTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBjYXNlICdzZWxlY3Rfbm90X2FueV9pbic6XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJJdGVtLm9wZXJhdG9yID0gRHluYW1pY0ZpbHRlck9wZXJhdG9yLk5vdEFueTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL0B0cy1pZ25vcmVcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YXJnZXRLZXkgPSAoX2IgPSBwcm9wcy5vcGVyYXRvcikgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLnJlcGxhY2VBbGwoXCJfXCIsIFwiXCIpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gRHluYW1pY0ZpbHRlck9wZXJhdG9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldEtleSA9PSAoa2V5LnRvTG93ZXJDYXNlKCkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vQHRzLWlnbm9yZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJJdGVtLm9wZXJhdG9yID0gRHluYW1pY0ZpbHRlck9wZXJhdG9yW2tleV07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmaWx0ZXJJdGVtLmZpZWxkID0gcHJvcHMuZmllbGQ7XG4gICAgICAgICAgICAgICAgZmlsdGVySXRlbS52YWx1ZSA9IHByb3BzLnZhbHVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGNoaWxkLmNoaWxkcmVuICYmIGNoaWxkLmNoaWxkcmVuLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIC8vIOWmguaenOacieWtkOiKgueCuSwg5YiZ6L2s5o2i5Li6Z3JhcGhxbOW9ouW8j+eahGZpbHRlclxuICAgICAgICAgICAgZmlsdGVySXRlbS5maWx0ZXJzID0gY29udmVydFRvSlNPTkZpbHRlcihjaGlsZC5jaGlsZHJlbik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZpbHRlckl0ZW07XG4gICAgfSk7XG4gICAgcmV0dXJuIGFycjtcbn1cbi8vQHRzLWlnbm9yZVxuZnVuY3Rpb24gZHluYW1pY0pzb25GaWx0ZXIoY29uZGl0aW9uKSB7XG4gICAgdmFyIF9hO1xuICAgIHZhciBkeW5hbWljRmlsdGVyID0ge1xuICAgICAgICBmaWx0ZXJzOiBbXVxuICAgIH07XG4gICAgLy8g5aaC5p6c5pyJ5a2Q6IqC54K5LCDliJnovazmjaLkuLpEeW5hbWljRmlsdGVy5b2i5byP55qEZmlsdGVyXG4gICAgaWYgKCgoX2EgPSBjb25kaXRpb24gPT09IG51bGwgfHwgY29uZGl0aW9uID09PSB2b2lkIDAgPyB2b2lkIDAgOiBjb25kaXRpb24uY2hpbGRyZW4pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5sZW5ndGgpID4gMCkge1xuICAgICAgICB2YXIgY2hpbGRyZW4gPSBjb25kaXRpb24uY2hpbGRyZW47XG4gICAgICAgIC8vIOWIqeeUqOmAkuW9kuWwhuetm+mAiei9rOaNouS4umdyYXBocWzlvaLlvI/nmoRmaWx0ZXLlrZfnrKbkuLJcbiAgICAgICAgdmFyIG1hcFJlc3VsdCA9IGNvbnZlcnRUb0pTT05GaWx0ZXIoY2hpbGRyZW4pO1xuICAgICAgICBpZiAobWFwUmVzdWx0KVxuICAgICAgICAgICAgaWYgKChtYXBSZXN1bHQgPT09IG51bGwgfHwgbWFwUmVzdWx0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBtYXBSZXN1bHQubGVuZ3RoKSA+IDEpIHtcbiAgICAgICAgICAgICAgICAvL0B0cy1pZ25vcmVcbiAgICAgICAgICAgICAgICBkeW5hbWljRmlsdGVyLmxvZ2ljID0gY29uZGl0aW9uLmNvbmp1bmN0aW9uO1xuICAgICAgICAgICAgICAgIGR5bmFtaWNGaWx0ZXIuZmlsdGVycyA9IG1hcFJlc3VsdDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGR5bmFtaWNGaWx0ZXIgPSBtYXBSZXN1bHRbMF07XG4gICAgICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShkeW5hbWljRmlsdGVyKTtcbiAgICAvLyByZXR1cm4gXCJ7XFxcImZpZWxkXFxcIjpcXFwiYWRkcmVzcy5jaXR5XFxcIixcXFwib3BlcmF0b3JcXFwiOlxcXCJFcVxcXCIsXFxcInZhbHVlXFxcIjpbXX1cIlxufVxuZnVuY3Rpb24gZ2VuR3JhcGhxbEZpbHRlcihjaGlsZHJlbikge1xuICAgIGNvbnNvbGUubG9nKCdnZW5HcmFwaHFsRmlsdGVyIGNoaWxkcmVuOiAnLCBjaGlsZHJlbik7XG4gICAgdmFyIGFyciA9IGNoaWxkcmVuLm1hcChmdW5jdGlvbiAoY2hpbGQpIHtcbiAgICAgICAgaWYgKGNoaWxkLmxlZnQgJiYgY2hpbGQubGVmdC5maWVsZCkge1xuICAgICAgICAgICAgaWYgKGNoaWxkLmxlZnQgJiYgY2hpbGQub3AgJiYgY2hpbGQucmlnaHQpIHtcbiAgICAgICAgICAgICAgICB2YXIgZmlsdGVyID0geyBmaWVsZDogY2hpbGQubGVmdC5maWVsZCwgb3BlcmF0b3I6IFwiXCIsIHZhbHVlOiBjaGlsZC5yaWdodCB9O1xuICAgICAgICAgICAgICAgIHN3aXRjaCAoY2hpbGQub3ApIHtcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnYmV0d2Vlbic6XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXIub3BlcmF0b3IgPSBcIlJBTkdFXCI7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnc2VsZWN0X2FueV9pbic6XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXIub3BlcmF0b3IgPSBcIkFOWVwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3NlbGVjdF9ub3RfYW55X2luJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlci5vcGVyYXRvciA9IFwiTk9UX0FOWVwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXIub3BlcmF0b3IgPSBjaGlsZC5vcDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgZmlsdGVyU3RyaW5nSm9pbiA9ICcnO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGl0ZW0gaW4gZmlsdGVyKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJTdHJpbmdKb2luKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJTdHJpbmdKb2luID0gZmlsdGVyU3RyaW5nSm9pbiArIFwiLFwiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChpdGVtID09PSBcImZpZWxkXCIgfHwgaXRlbSA9PT0gXCJ2YWx1ZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJTdHJpbmdKb2luID0gZmlsdGVyU3RyaW5nSm9pbiArIGl0ZW0gKyAnOlwiJyArIGZpbHRlcltpdGVtXSArICdcIic7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAoaXRlbSA9PT0gXCJvcGVyYXRvclwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJTdHJpbmdKb2luID0gZmlsdGVyU3RyaW5nSm9pbiArIGl0ZW0gKyAnOicgKyBmaWx0ZXJbaXRlbV07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiZmlsdGVyW2l0ZW1dOiBcIiwgZmlsdGVyLCBpdGVtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBcInt9XCI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwie1wiICsgZmlsdGVyU3RyaW5nSm9pbiArIFwifVwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwie31cIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjaGlsZC5jaGlsZHJlbiAmJiBjaGlsZC5jaGlsZHJlbi5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICB2YXIgZ2VuQ2hpbGRzID0gZ2VuR3JhcGhxbEZpbHRlcihjaGlsZC5jaGlsZHJlbik7XG4gICAgICAgICAgICBpZiAoZ2VuQ2hpbGRzID09PSBcIltdXCIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJ7fVwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwie1wiICsgXCJsb2dpYzpcIiArIGNoaWxkLmNvbmp1bmN0aW9uICsgXCIsZmlsdGVyczpcIiArIGdlbkNoaWxkcyArIFwifVwiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIFwie31cIjtcbiAgICAgICAgfVxuICAgIH0pLmZpbHRlcihmdW5jdGlvbiAoaXRlbSkgeyByZXR1cm4gaXRlbSAhPT0gXCJ7fVwiOyB9KTtcbiAgICBjb25zb2xlLmxvZygnYXJyOiAnLCBhcnIpO1xuICAgIGlmIChhcnIubGVuZ3RoID4gMCkge1xuICAgICAgICByZXR1cm4gXCJbXCIgKyBhcnIuam9pbihcIixcIikgKyBcIl1cIjtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiBcIltdXCI7XG4gICAgfVxuICAgIC8vcmV0dXJuIEpTT04uc3RyaW5naWZ5KGFycik7XG59XG4vL0B0cy1pZ25vcmVcbndpbmRvdy5hbWlzRXh0ID0ge1xuICAgIGR5bmFtaWNKc29uRmlsdGVyOiBkeW5hbWljSnNvbkZpbHRlcixcbiAgICBjb252ZXJ0Q29uZGl0aW9uOiBmdW5jdGlvbiAoY29uZGl0aW9uKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGNvbmRpdGlvbiwgXCJjb252ZXJ0Q29uZGl0aW9uXCIpO1xuICAgICAgICB2YXIgZmlsdGVyU3RyaW5nID0gXCJcIjtcbiAgICAgICAgLy8g5aaC5p6c5pyJ5a2Q6IqC54K5LCDliJnovazmjaLkuLpncmFwaHFs5b2i5byP55qEZmlsdGVyXG4gICAgICAgIGlmIChjb25kaXRpb24gJiYgY29uZGl0aW9uLmNoaWxkcmVuICYmIGNvbmRpdGlvbi5jaGlsZHJlbi5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICB2YXIgY2hpbGRyZW4gPSBjb25kaXRpb24uY2hpbGRyZW47XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnY2hpbGRyZW46ICcsIGNoaWxkcmVuKTtcbiAgICAgICAgICAgIC8vIOWIqeeUqOmAkuW9kuWwhuetm+mAiei9rOaNouS4umdyYXBocWzlvaLlvI/nmoRmaWx0ZXLlrZfnrKbkuLJcbiAgICAgICAgICAgIGZpbHRlclN0cmluZyA9IFwie1wiICsgXCJsb2dpYzpcIiArIGNvbmRpdGlvbi5jb25qdW5jdGlvbiArIFwiLFwiICsgXCJmaWx0ZXJzOlwiICsgZ2VuR3JhcGhxbEZpbHRlcihjaGlsZHJlbikgKyBcIn1cIjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZmlsdGVyU3RyaW5nKSB7XG4gICAgICAgICAgICByZXR1cm4gZmlsdGVyU3RyaW5nO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIFwie31cIjtcbiAgICAgICAgfVxuICAgIH1cbn07XG4iXX0=
