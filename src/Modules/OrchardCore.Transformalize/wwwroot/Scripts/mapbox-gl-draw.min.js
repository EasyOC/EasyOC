(function(n){if(typeof exports=="object"&&typeof module!="undefined")module.exports=n();else if(typeof define=="function"&&define.amd)define([],n);else{var t;t=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:this;t.MapboxDraw=n()}})(function(){return function n(t,i,r){function u(f,o){var h,c,s;if(!i[f]){if(!t[f]){if(h=typeof require=="function"&&require,!o&&h)return h(f,!0);if(e)return e(f,!0);c=new Error("Cannot find module '"+f+"'");throw c.code="MODULE_NOT_FOUND",c;}s=i[f]={exports:{}};t[f][0].call(s.exports,function(n){var i=t[f][1][n];return u(i?i:n)},s,s.exports,n,t,i,r)}return i[f].exports}for(var e=typeof require=="function"&&require,f=0;f<r.length;f++)u(r[f]);return u}({1:[function(n,t){"use strict";var i=n("./src/setup"),r=n("./src/options"),u=n("./src/api"),f=n("./src/constants"),e=function(n,t){var e,o;return n=r(n),e={options:n},t=u(e,t),e.api=t,o=i(e),t.onAdd=o.onAdd,t.onRemove=o.onRemove,t.types=f.types,t.options=n,t};t.exports=function(n){e(n,this)};t.exports.modes=n("./src/modes")},{"./src/api":22,"./src/constants":23,"./src/modes":56,"./src/options":61,"./src/setup":63}],2:[function(n,t){function i(n){if(!(this instanceof i))return new i(n);this._bbox=n||[Infinity,Infinity,-Infinity,-Infinity];this._valid=!!n}t.exports=i;i.prototype.include=function(n){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],n[0]),this._bbox[1]=Math.min(this._bbox[1],n[1]),this._bbox[2]=Math.max(this._bbox[2],n[0]),this._bbox[3]=Math.max(this._bbox[3],n[1]),this};i.prototype.equals=function(n){var t;return t=n instanceof i?n.bbox():n,this._bbox[0]==t[0]&&this._bbox[1]==t[1]&&this._bbox[2]==t[2]&&this._bbox[3]==t[3]};i.prototype.center=function(){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null};i.prototype.union=function(n){this._valid=!0;var t;return t=n instanceof i?n.bbox():n,this._bbox[0]=Math.min(this._bbox[0],t[0]),this._bbox[1]=Math.min(this._bbox[1],t[1]),this._bbox[2]=Math.max(this._bbox[2],t[2]),this._bbox[3]=Math.max(this._bbox[3],t[3]),this};i.prototype.bbox=function(){return this._valid?this._bbox:null};i.prototype.contains=function(n){if(!n)return this._fastContains();if(!this._valid)return null;var t=n[0],i=n[1];return this._bbox[0]<=t&&this._bbox[1]<=i&&this._bbox[2]>=t&&this._bbox[3]>=i};i.prototype.intersect=function(n){if(!this._valid)return null;var t;return t=n instanceof i?n.bbox():n,!(this._bbox[0]>t[2]||this._bbox[2]<t[0]||this._bbox[3]<t[1]||this._bbox[1]>t[3])};i.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var n="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",n)};i.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null}},{}],3:[function(n,t){function f(n){var i=0,t;switch(n.type){case"Polygon":return e(n.coordinates);case"MultiPolygon":for(t=0;t<n.coordinates.length;t++)i+=e(n.coordinates[t]);return i;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(t=0;t<n.geometries.length;t++)i+=f(n.geometries[t]);return i}}function e(n){var r=0,t;if(n&&n.length>0)for(r+=Math.abs(i(n[0])),t=1;t<n.length;t++)r-=Math.abs(i(n[t]));return r}function i(n){var h,c,l,f,e,o,t,s=0,i=n.length;if(i>2){for(t=0;t<i;t++)t===i-2?(f=i-2,e=i-1,o=0):t===i-1?(f=i-1,e=0,o=1):(f=t,e=t+1,o=t+2),h=n[f],c=n[e],l=n[o],s+=(r(l[0])-r(h[0]))*Math.sin(r(c[1]));s=s*u.RADIUS*u.RADIUS/2}return s}function r(n){return n*Math.PI/180}var u=n("wgs84");t.exports.geometry=f;t.exports.ring=i},{wgs84:20}],4:[function(n,t){t.exports=function(n){function t(n){return Array.isArray(n)&&n.length&&typeof n[0]=="number"?[n]:n.reduce(function(n,i){return Array.isArray(i)&&Array.isArray(i[0])?n.concat(t(i)):(n.push(i),n)},[])}return t(n)}},{}],5:[function(n,t){var i=n("@mapbox/geojson-normalize"),r=n("geojson-flatten"),u=n("./flatten");t.exports=function(n){if(!n)return[];var f=r(i(n)),t=[];return f.features.forEach(function(n){n.geometry&&(t=t.concat(u(n.geometry.coordinates)))}),t}},{"./flatten":4,"@mapbox/geojson-normalize":7,"geojson-flatten":13}],6:[function(n,t){function i(n){for(var i=e(),r=u(n),t=0;t<r.length;t++)i.include(r[t]);return i}var u=n("@mapbox/geojson-coords"),f=n("traverse"),e=n("@mapbox/extent"),r={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},o=Object.keys(r);t.exports=function(n){return i(n).bbox()};t.exports.polygon=function(n){return i(n).polygon()};t.exports.bboxify=function(n){return f(n).map(function(n){if(n){var t=o.some(function(t){return n[t]?r[t].indexOf(n.type)!==-1:!1});t&&(n.bbox=i(n).bbox(),this.update(n))}})}},{"@mapbox/extent":2,"@mapbox/geojson-coords":5,traverse:19}],7:[function(n,t){function r(n){if(!n||!n.type)return null;var t=i[n.type];return t?t==="geometry"?{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:n}]}:t==="feature"?{type:"FeatureCollection",features:[n]}:t==="featurecollection"?n:void 0:null}t.exports=r;var i={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"}},{}],8:[function(n,t){function u(n,t){var u,e,o;if(typeof n=="object")u=n;else if(typeof n=="string")try{u=i.parse(n)}catch(f){return e=f.message.match(/line (\d+)/),o=parseInt(e[1],10),[{line:o-1,message:f.message,error:f}]}else return[{message:"Expected string or object as input",line:0}];return[].concat(r.hint(u,t))}var i=n("jsonlint-lines"),r=n("./object");t.exports.hint=u},{"./object":9,"jsonlint-lines":15}],9:[function(n,t){function r(n,t){function l(n){if((!t||t.noDuplicateMembers!==!1)&&n.__duplicateProperties__&&r.push({message:"An object contained duplicate members, making parsing ambigous: "+n.__duplicateProperties__.join(", "),line:n.__line__}),!u(n,"type","string"))if(a[n.type])n&&a[n.type](n);else{var i=ut[n.type.toLowerCase()];i!==undefined?r.push({message:"Expected "+i+" but got "+n.type+" (case sensitive)",line:n.__line__}):r.push({message:"The type "+n.type+" is unknown",line:n.__line__})}}function h(n,t){return n.every(function(n){return n!==null&&typeof n===t})}function u(n,t,i){if(typeof n[t]=="undefined")return r.push({message:'"'+t+'" member required',line:n.__line__});if(i==="array"){if(!Array.isArray(n[t]))return r.push({message:'"'+t+'" member should be an array, but is an '+typeof n[t]+" instead",line:n.__line__})}else{if(i==="object"&&n[t]&&n[t].constructor.name!=="Object")return r.push({message:'"'+t+'" member should be '+i+", but is an "+n[t].constructor.name+" instead",line:n.__line__});if(i&&typeof n[t]!==i)return r.push({message:'"'+t+'" member should be '+i+", but is an "+typeof n[t]+" instead",line:n.__line__})}}function w(n){if(f(n),e(n),n.properties!==undefined&&r.push({message:'FeatureCollection object cannot contain a "properties" member',line:n.__line__}),n.coordinates!==undefined&&r.push({message:'FeatureCollection object cannot contain a "coordinates" member',line:n.__line__}),!u(n,"features","array")){if(!h(n.features,"object"))return r.push({message:"Every feature must be an object",line:n.__line__});n.features.forEach(y)}}function v(n,i){if(!Array.isArray(n))return r.push({message:"position should be an array, is a "+typeof n+" instead",line:n.__line__||i});if(n.length<2)return r.push({message:"position must have 2 or more elements",line:n.__line__||i});if(n.length>3)return r.push({message:"position should not have more than 3 elements",level:"message",line:n.__line__||i});if(!h(n,"number"))return r.push({message:"each element in a position must be a number",line:n.__line__||i});if(t&&t.precisionWarning){if(s===c)return s+=1,r.push({message:"truncated warnings: we've encountered coordinate precision warning "+c+" times, no more warnings will be reported",level:"message",line:n.__line__||i});s<c&&n.forEach(function(t){var u=0,f=String(t).split(".")[1];return f!==undefined&&(u=f.length),u>p?(s+=1,r.push({message:"precision of coordinates should be reduced",level:"message",line:n.__line__||i})):void 0})}}function o(n,t,i,u){if(u===undefined&&n.__line__!==undefined&&(u=n.__line__),i===0)return v(n,u);if(i===1&&t)if(t==="LinearRing"){if(!Array.isArray(n[n.length-1]))return r.push({message:"a number was found where a coordinate array should have been found: this needs to be nested more deeply",line:u}),!0;if(n.length<4&&r.push({message:"a LinearRing of coordinates needs to have four or more positions",line:u}),n.length&&(n[n.length-1].length!==n[0].length||!n[n.length-1].every(function(t,i){return n[0][i]===t})))return r.push({message:"the first and last positions in a LinearRing of coordinates must be the same",line:u}),!0}else if(t==="Line"&&n.length<2)return r.push({message:"a line needs to have two or more coordinates to be valid",line:u});if(Array.isArray(n)){var f=n.map(function(n){return o(n,t,i-1,n.__line__||u)});return f.some(function(n){return n})}r.push({message:"a number was found where a coordinate array should have been found: this needs to be nested more deeply",line:u})}function f(n){if(n.crs)typeof n.crs=="object"&&n.crs.properties&&n.crs.properties.name==="urn:ogc:def:crs:OGC:1.3:CRS84"?r.push({message:"old-style crs member is not recommended, this object is equivalent to the default and should be removed",line:n.__line__}):r.push({message:"old-style crs member is not recommended",line:n.__line__})}function e(n){if(n.bbox){if(Array.isArray(n.bbox))return h(n.bbox,"number")||r.push({message:"each element in a bbox member must be a number",line:n.bbox.__line__}),n.bbox.length===4||n.bbox.length===6||r.push({message:"bbox must contain 4 elements (for 2D) or 6 elements (for 3D)",line:n.bbox.__line__}),r.length;r.push({message:"bbox member must be an array of numbers, but is a "+typeof n.bbox,line:n.__line__})}}function b(n){n.properties!==undefined&&r.push({message:'geometry object cannot contain a "properties" member',line:n.__line__});n.geometry!==undefined&&r.push({message:'geometry object cannot contain a "geometry" member',line:n.__line__});n.features!==undefined&&r.push({message:'geometry object cannot contain a "features" member',line:n.__line__})}function k(n){f(n);e(n);b(n);u(n,"coordinates","array")||v(n.coordinates)}function d(n){f(n);e(n);u(n,"coordinates","array")||o(n.coordinates,"LinearRing",2)||i(n,r)}function g(n){f(n);e(n);u(n,"coordinates","array")||o(n.coordinates,"LinearRing",3)||i(n,r)}function nt(n){f(n);e(n);u(n,"coordinates","array")||o(n.coordinates,"Line",1)}function tt(n){f(n);e(n);u(n,"coordinates","array")||o(n.coordinates,"Line",2)}function it(n){f(n);e(n);u(n,"coordinates","array")||o(n.coordinates,"",1)}function rt(n){f(n);e(n);u(n,"geometries","array")||(h(n.geometries,"object")||r.push({message:"The geometries array in a GeometryCollection must contain only geometry objects",line:n.__line__}),n.geometries.length===1&&r.push({message:"GeometryCollection with a single geometry should be avoided in favor of single part or a single object of multi-part type",line:n.geometries.__line__}),n.geometries.forEach(function(t){t&&(t.type==="GeometryCollection"&&r.push({message:"GeometryCollection should avoid nested geometry collections",line:n.geometries.__line__}),l(t))}))}function y(n){f(n);e(n);n.id!==undefined&&typeof n.id!="string"&&typeof n.id!="number"&&r.push({message:'Feature "id" member must have a string or number value',line:n.__line__});n.features!==undefined&&r.push({message:'Feature object cannot contain a "features" member',line:n.__line__});n.coordinates!==undefined&&r.push({message:'Feature object cannot contain a "coordinates" member',line:n.__line__});n.type!=="Feature"&&r.push({message:"GeoJSON features must have a type=feature member",line:n.__line__});u(n,"properties","object");u(n,"geometry","object")||n.geometry&&l(n.geometry)}var r=[],s=0,c=10,p=6,a={Point:k,Feature:y,MultiPoint:it,LineString:nt,MultiLineString:tt,FeatureCollection:w,GeometryCollection:rt,Polygon:d,MultiPolygon:g},ut=Object.keys(a).reduce(function(n,t){return n[t.toLowerCase()]=t,n},{});return typeof n!="object"||n===null||n===undefined?(r.push({message:"The root of a GeoJSON object must be an object.",line:0}),r):(l(n),r.forEach(function(n){({}).hasOwnProperty.call(n,"line")&&n.line===undefined&&delete n.line}),r)}var i=n("./rhr");t.exports.hint=r},{"./rhr":10}],10:[function(n,t){function i(n){return n*Math.PI/180}function r(n){var f=0,r,u,t;if(n.length>2)for(t=0;t<n.length-1;t++)r=n[t],u=n[t+1],f+=i(u[0]-r[0])*(2+Math.sin(i(r[1]))+Math.sin(i(u[1])));return f>=0}function u(n){if(n&&n.length>0){if(r(n[0]))return!1;var t=n.slice(1,n.length);if(!t.every(r))return!1}return!0}function f(n){return n.type==="Polygon"?u(n.coordinates):n.type==="MultiPolygon"?n.coordinates.every(u):void 0}t.exports=function(n,t){f(n)||t.push({message:"Polygons and MultiPolygons should follow the right-hand rule",level:"message",line:n.__line__})}},{}],11:[function(n,t){"use strict";function i(n,t){this.x=n;this.y=t}t.exports=i;i.prototype={clone:function(){return new i(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,t){return this.clone()._rotateAround(n,t)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var t=n.x-this.x,i=n.y-this.y;return t*t+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,t){return Math.atan2(this.x*t-this.y*n,this.x*n+this.y*t)},_matMult:function(n){var t=n[0]*this.x+n[1]*this.y,i=n[2]*this.x+n[3]*this.y;return this.x=t,this.y=i,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var t=Math.cos(n),i=Math.sin(n),r=t*this.x-i*this.y,u=i*this.x+t*this.y;return this.x=r,this.y=u,this},_rotateAround:function(n,t){var i=Math.cos(n),r=Math.sin(n),u=t.x+i*(this.x-t.x)-r*(this.y-t.y),f=t.y+r*(this.x-t.x)+i*(this.y-t.y);return this.x=u,this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}};i.convert=function(n){return n instanceof i?n:Array.isArray(n)?new i(n[0],n[1]):n}},{}],12:[function(){},{}],13:[function(n,t){function i(n){switch(n&&n.type||null){case"FeatureCollection":return n.features=n.features.reduce(function(n,t){return n.concat(i(t))},[]),n;case"Feature":return n.geometry?i(n.geometry).map(function(t){return{type:"Feature",properties:JSON.parse(JSON.stringify(n.properties)),geometry:t}}):n;case"MultiPoint":return n.coordinates.map(function(n){return{type:"Point",coordinates:n}});case"MultiPolygon":return n.coordinates.map(function(n){return{type:"Polygon",coordinates:n}});case"MultiLineString":return n.coordinates.map(function(n){return{type:"LineString",coordinates:n}});case"GeometryCollection":return n.geometries.map(i).reduce(function(n,t){return n.concat(t)},[]);case"Point":case"Polygon":case"LineString":return[n]}}t.exports=i},{}],14:[function(n,t){var i=t.exports=function(n,t){var f,o,u,r,h,e,s;if(t||(t=16),n===undefined&&(n=128),n<=0)return"0";for(f=Math.log(Math.pow(2,n))/Math.log(t),r=2;f===Infinity;r*=2)f=Math.log(Math.pow(2,n/r))/Math.log(t)*r;for(o=f-Math.floor(f),u="",r=0;r<Math.floor(f);r++)e=Math.floor(Math.random()*t).toString(t),u=e+u;return o&&(h=Math.pow(t,o),e=Math.floor(Math.random()*h).toString(t),u=e+u),s=parseInt(u,t),s!==Infinity&&s>=Math.pow(2,n)?i(n,t):u};i.rack=function(n,t,r){var u=function(u){var o=0,e;do{if(o++>10)if(r)n+=r;else throw new Error("too many ID collisions, use more bits");e=i(n,t)}while(Object.hasOwnProperty.call(f,e));return f[e]=u,e},f=u.hats={};return u.get=function(n){return u.hats[n]},u.set=function(n,t){return u.hats[n]=t,u},u.bits=n||128,u.base=t||16,u}},{}],15:[function(n,t,i){(function(r){var u=function(){function l(){this.yy={}}var n=function(n,t,i,r){for(i=i||{},r=n.length;r--;i[n[r]]=t);return i},i=[1,12],r=[1,13],u=[1,9],f=[1,10],e=[1,11],o=[1,14],s=[1,15],t=[14,18,22,24],h=[18,22],a=[22,24],c={trace:function(){},yy:{},symbols_:{error:2,JSONString:3,STRING:4,JSONNumber:5,NUMBER:6,JSONNullLiteral:7,NULL:8,JSONBooleanLiteral:9,TRUE:10,FALSE:11,JSONText:12,JSONValue:13,EOF:14,JSONObject:15,JSONArray:16,"{":17,"}":18,JSONMemberList:19,JSONMember:20,":":21,",":22,"[":23,"]":24,JSONElementList:25,$accept:0,$end:1},terminals_:{2:"error",4:"STRING",6:"NUMBER",8:"NULL",10:"TRUE",11:"FALSE",14:"EOF",17:"{",18:"}",21:":",22:",",23:"[",24:"]"},productions_:[0,[3,1],[5,1],[7,1],[9,1],[9,1],[12,2],[13,1],[13,1],[13,1],[13,1],[13,1],[13,1],[15,2],[15,3],[20,3],[19,1],[19,3],[16,2],[16,3],[25,1],[25,3]],performAction:function(n,t,i,r,u,f){var e=f.length-1;switch(u){case 1:this.$=n.replace(/\\(\\|")/g,"$1").replace(/\\n/g,"\n").replace(/\\r/g,"\r").replace(/\\t/g,"\t").replace(/\\v/g,'\v').replace(/\\f/g,"\f").replace(/\\b/g,"\b");break;case 2:this.$=Number(n);break;case 3:this.$=null;break;case 4:this.$=!0;break;case 5:this.$=!1;break;case 6:return this.$=f[e-1];case 13:this.$={};Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 14:case 19:this.$=f[e-1];Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 15:this.$=[f[e-2],f[e]];break;case 16:this.$={};this.$[f[e][0]]=f[e][1];break;case 17:this.$=f[e-2];f[e-2][f[e][0]]!==undefined&&(this.$.__duplicateProperties__||Object.defineProperty(this.$,"__duplicateProperties__",{value:[],enumerable:!1}),this.$.__duplicateProperties__.push(f[e][0]));f[e-2][f[e][0]]=f[e][1];break;case 18:this.$=[];Object.defineProperty(this.$,"__line__",{value:this._$.first_line,enumerable:!1});break;case 20:this.$=[f[e]];break;case 21:this.$=f[e-2];f[e-2].push(f[e])}},table:[{3:5,4:i,5:6,6:r,7:3,8:u,9:4,10:f,11:e,12:1,13:2,15:7,16:8,17:o,23:s},{1:[3]},{14:[1,16]},n(t,[2,7]),n(t,[2,8]),n(t,[2,9]),n(t,[2,10]),n(t,[2,11]),n(t,[2,12]),n(t,[2,3]),n(t,[2,4]),n(t,[2,5]),n([14,18,21,22,24],[2,1]),n(t,[2,2]),{3:20,4:i,18:[1,17],19:18,20:19},{3:5,4:i,5:6,6:r,7:3,8:u,9:4,10:f,11:e,13:23,15:7,16:8,17:o,23:s,24:[1,21],25:22},{1:[2,6]},n(t,[2,13]),{18:[1,24],22:[1,25]},n(h,[2,16]),{21:[1,26]},n(t,[2,18]),{22:[1,28],24:[1,27]},n(a,[2,20]),n(t,[2,14]),{3:20,4:i,20:29},{3:5,4:i,5:6,6:r,7:3,8:u,9:4,10:f,11:e,13:30,15:7,16:8,17:o,23:s},n(t,[2,19]),{3:5,4:i,5:6,6:r,7:3,8:u,9:4,10:f,11:e,13:31,15:7,16:8,17:o,23:s},n(h,[2,17]),n(h,[2,15]),n(a,[2,21])],defaultActions:{16:[2,6]},parseError:function(n,t){if(t.recoverable)this.trace(n);else{function i(n,t){this.message=n;this.hash=t}i.prototype=Error;throw new i(n,t);}},parse:function(n){var et=this,u=[0],e=[null],t=[],l=this.table,g="",a=0,nt=0,tt=0,it=1,ot=t.slice.call(arguments,1),i=Object.create(this.lexer),s={yy:{}},v,y,rt,ut,r,b,h,f,k,c,p,o,ft,w,d;for(v in this.yy)Object.prototype.hasOwnProperty.call(this.yy,v)&&(s.yy[v]=this.yy[v]);for(i.setInput(n,s.yy),s.yy.lexer=i,s.yy.parser=this,typeof i.yylloc=="undefined"&&(i.yylloc={}),y=i.yylloc,t.push(y),rt=i.options&&i.options.ranges,this.parseError=typeof s.yy.parseError=="function"?s.yy.parseError:Object.getPrototypeOf(this).parseError,ut=function(){var n;return n=i.lex()||it,typeof n!="number"&&(n=et.symbols_[n]||n),n},c={};;){if(h=u[u.length-1],this.defaultActions[h]?f=this.defaultActions[h]:((r===null||typeof r=="undefined")&&(r=ut()),f=l[h]&&l[h][r]),typeof f=="undefined"||!f.length||!f[0]){d="";w=[];for(p in l[h])this.terminals_[p]&&p>2&&w.push("'"+this.terminals_[p]+"'");d=i.showPosition?"Parse error on line "+(a+1)+":\n"+i.showPosition()+"\nExpecting "+w.join(", ")+", got '"+(this.terminals_[r]||r)+"'":"Parse error on line "+(a+1)+": Unexpected "+(r==it?"end of input":"'"+(this.terminals_[r]||r)+"'");this.parseError(d,{text:i.match,token:this.terminals_[r]||r,line:i.yylineno,loc:y,expected:w})}if(f[0]instanceof Array&&f.length>1)throw new Error("Parse Error: multiple actions possible at state: "+h+", token: "+r);switch(f[0]){case 1:u.push(r);e.push(i.yytext);t.push(i.yylloc);u.push(f[1]);r=null;b?(r=b,b=null):(nt=i.yyleng,g=i.yytext,a=i.yylineno,y=i.yylloc,tt>0&&tt--);break;case 2:if(o=this.productions_[f[1]][1],c.$=e[e.length-o],c._$={first_line:t[t.length-(o||1)].first_line,last_line:t[t.length-1].last_line,first_column:t[t.length-(o||1)].first_column,last_column:t[t.length-1].last_column},rt&&(c._$.range=[t[t.length-(o||1)].range[0],t[t.length-1].range[1]]),k=this.performAction.apply(c,[g,nt,a,s.yy,f[1],e,t].concat(ot)),typeof k!="undefined")return k;o&&(u=u.slice(0,-2*o),e=e.slice(0,-1*o),t=t.slice(0,-1*o));u.push(this.productions_[f[1]][0]);e.push(c.$);t.push(c._$);ft=l[u[u.length-2]][u[u.length-1]];u.push(ft);break;case 3:return!0}}return!0}},v=function(){return{EOF:1,parseError:function(n,t){if(this.yy.parser)this.yy.parser.parseError(n,t);else throw new Error(n);},setInput:function(n,t){return this.yy=t||this.yy||{},this._input=n,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var n=this._input[0],t;return this.yytext+=n,this.yyleng++,this.offset++,this.match+=n,this.matched+=n,t=n.match(/(?:\r\n?|\n).*/g),t?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),n},unput:function(n){var i=n.length,t=n.split(/(?:\r\n?|\n)/g),r,u;return this._input=n+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-i),this.offset-=i,r=this.match.split(/(?:\r\n?|\n)/g),this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),t.length-1&&(this.yylineno-=t.length-1),u=this.yylloc.range,this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:t?(t.length===r.length?this.yylloc.first_column:0)+r[r.length-t.length].length-t[0].length:this.yylloc.first_column-i},this.options.ranges&&(this.yylloc.range=[u[0],u[0]+this.yyleng-i]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){if(this.options.backtrack_lexer)this._backtrack=!0;else return this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno});return this},less:function(n){this.unput(this.match.slice(n))},pastInput:function(){var n=this.matched.substr(0,this.matched.length-this.match.length);return(n.length>20?"...":"")+n.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var n=this.match;return n.length<20&&(n+=this._input.substr(0,20-n.length)),(n.substr(0,20)+(n.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var n=this.pastInput(),t=new Array(n.length+1).join("-");return n+this.upcomingInput()+"\n"+t+"^"},test_match:function(n,t){var u,i,r,f;if(this.options.backtrack_lexer&&(r={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(r.yylloc.range=this.yylloc.range.slice(0))),i=n[0].match(/(?:\r\n?|\n).*/g),i&&(this.yylineno+=i.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:i?i[i.length-1].length-i[i.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+n[0].length},this.yytext+=n[0],this.match+=n[0],this.matches=n,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(n[0].length),this.matched+=n[0],u=this.performAction.call(this,this.yy,this,t,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),u)return u;if(this._backtrack){for(f in r)this[f]=r[f];return!1}return!1},next:function(){var n,t,r,f,u,i;if(this.done)return this.EOF;for(this._input||(this.done=!0),this._more||(this.yytext="",this.match=""),u=this._currentRules(),i=0;i<u.length;i++)if(r=this._input.match(this.rules[u[i]]),r&&(!t||r[0].length>t[0].length))if(t=r,f=i,this.options.backtrack_lexer){if(n=this.test_match(r,u[i]),n!==!1)return n;if(this._backtrack){t=!1;continue}else return!1}else if(!this.options.flex)break;return t?(n=this.test_match(t,u[f]),n!==!1)?n:!1:this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var n=this.next();return n?n:this.lex()},begin:function(n){this.conditionStack.push(n)},popState:function(){var n=this.conditionStack.length-1;return n>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(n){return n=this.conditionStack.length-1-Math.abs(n||0),n>=0?this.conditionStack[n]:"INITIAL"},pushState:function(n){this.begin(n)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(n,t,i,r){var u=r;switch(i){case 1:return 6;case 2:return t.yytext=t.yytext.substr(1,t.yyleng-2),4;case 3:return 17;case 4:return 18;case 5:return 23;case 6:return 24;case 7:return 22;case 8:return 21;case 9:return 10;case 10:return 11;case 11:return 8;case 12:return 14;case 13:return"INVALID"}},rules:[/^(?:\s+)/,/^(?:(-?([0-9]|[1-9][0-9]+))(\.[0-9]+)?([eE][-+]?[0-9]+)?\b)/,/^(?:"(?:\\[\\"bfnrt\/]|\\u[a-fA-F0-9]{4}|[^\\\0-\x09\x0a-\x1f"])*")/,/^(?:\{)/,/^(?:\})/,/^(?:\[)/,/^(?:\])/,/^(?:,)/,/^(?::)/,/^(?:true\b)/,/^(?:false\b)/,/^(?:null\b)/,/^(?:$)/,/^(?:.)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13],inclusive:!0}}}}();return c.lexer=v,l.prototype=c,c.Parser=l,new l}();typeof n!="undefined"&&typeof i!="undefined"&&(i.parser=u,i.Parser=u.Parser,i.parse=function(){return u.parse.apply(u,arguments)},i.main=function(t){t[1]||(console.log("Usage: "+t[0]+" FILE"),r.exit(1));var u=n("fs").readFileSync(n("path").normalize(t[1]),"utf8");return i.parser.parse(u)},typeof t!="undefined"&&n.main===t&&i.main(r.argv.slice(1)))}).call(this,n("_process"))},{_process:18,fs:12,path:17}],16:[function(n,t,i){(function(n){function ru(n,t){for(var i=-1,f=n==null?0:n.length,e=0,u=[],r;++i<f;)r=n[i],t(r,i,n)&&(u[e++]=r);return u}function uu(n,t){for(var i=-1,r=t.length,u=n.length;++i<r;)n[u+i]=t[i];return n}function fu(n,t){for(var i=-1,r=n==null?0:n.length;++i<r;)if(t(n[i],i,n))return!0;return!1}function eu(n,t){for(var i=-1,r=Array(n);++i<n;)r[i]=t(i);return r}function ou(n){return function(t){return n(t)}}function su(n,t){return n.has(t)}function hu(n,t){return n==null?undefined:n[t]}function cu(n){var i=-1,t=Array(n.size);return n.forEach(function(n,r){t[++i]=[r,n]}),t}function lu(n,t){return function(i){return n(t(i))}}function au(n){var i=-1,t=Array(n.size);return n.forEach(function(n){t[++i]=n}),t}function c(n){var i=-1,r=n==null?0:n.length,t;for(this.clear();++i<r;)t=n[i],this.set(t[0],t[1])}function uf(){this.__data__=w?w(null):{};this.size=0}function ff(n){var t=this.has(n)&&delete this.__data__[n];return this.size-=t?1:0,t}function ef(n){var t=this.__data__,i;return w?(i=t[n],i===ct?undefined:i):u.call(t,n)?t[n]:undefined}function of(n){var t=this.__data__;return w?t[n]!==undefined:u.call(t,n)}function sf(n,t){var i=this.__data__;return this.size+=this.has(n)?0:1,i[n]=w&&t===undefined?ct:t,this}function e(n){var i=-1,r=n==null?0:n.length,t;for(this.clear();++i<r;)t=n[i],this.set(t[0],t[1])}function hf(){this.__data__=[];this.size=0}function cf(n){var t=this.__data__,i=ot(t,n),r;return i<0?!1:(r=t.length-1,i==r?t.pop():wu.call(t,i,1),--this.size,!0)}function lf(n){var t=this.__data__,i=ot(t,n);return i<0?undefined:t[i][1]}function af(n){return ot(this.__data__,n)>-1}function vf(n,t){var i=this.__data__,r=ot(i,n);return r<0?(++this.size,i.push([n,t])):i[r][1]=t,this}function l(n){var i=-1,r=n==null?0:n.length,t;for(this.clear();++i<r;)t=n[i],this.set(t[0],t[1])}function yf(){this.size=0;this.__data__={hash:new c,map:new(p||e),string:new c}}function pf(n){var t=st(this,n)["delete"](n);return this.size-=t?1:0,t}function wf(n){return st(this,n).get(n)}function bf(n){return st(this,n).has(n)}function kf(n,t){var i=st(this,n),r=i.size;return i.set(n,t),this.size+=i.size==r?0:1,this}function et(n){var t=-1,i=n==null?0:n.length;for(this.__data__=new l;++t<i;)this.add(n[t])}function df(n){return this.__data__.set(n,ct),this}function gf(n){return this.__data__.has(n)}function s(n){var t=this.__data__=new e(n);this.size=t.size}function ne(){this.__data__=new e;this.size=0}function te(n){var t=this.__data__,i=t["delete"](n);return this.size=t.size,i}function ie(n){return this.__data__.get(n)}function re(n){return this.__data__.has(n)}function ue(n,t){var i=this.__data__,r;if(i instanceof e){if(r=i.__data__,!p||r.length<yr-1)return r.push([n,t]),this.size=++i.size,this;i=this.__data__=new l(r)}return i.set(n,t),this.size=i.size,this}function fe(n,t){var r=k(n),f=!r&&cr(n),e=!r&&!f&&ht(n),s=!r&&!f&&!e&&gt(n),h=r||f||e||s,o=h?eu(n.length,String):[],c=o.length;for(var i in n)!(t||u.call(n,i))||h&&(i=="length"||e&&(i=="offset"||i=="parent")||s&&(i=="buffer"||i=="byteLength"||i=="byteOffset")||ye(i,c))||o.push(i);return o}function ot(n,t){for(var i=n.length;i--;)if(hr(n[i][0],t))return i;return-1}function ee(n,t,i){var r=t(n);return k(n)?r:uu(r,i(n))}function b(n){return n==null?n===undefined?gr:br:h&&h in Object(n)?ve(n):ke(n)}function ur(n){return d(n)&&b(n)==nt}function fr(n,t,i,r,u){return n===t?!0:n==null||t==null||!d(n)&&!d(t)?n!==n&&t!==t:oe(n,t,i,r,fr,u)}function oe(n,t,i,r,f,e){var l=k(n),tt=k(t),h=l?lt:o(n),c=tt?lt:o(t),p,w,b,d;h=h==nt?v:h;c=c==nt?v:c;var a=h==v,it=c==v,y=h==c;if(y&&ht(n)){if(!ht(t))return!1;l=!0;a=!1}return y&&!a?(e||(e=new s),l||gt(n)?er(n,t,i,r,f,e):le(n,t,h,i,r,f,e)):!(i&g)&&(p=a&&u.call(n,"__wrapped__"),w=it&&u.call(t,"__wrapped__"),p||w)?(b=p?n.value():n,d=w?t.value():t,e||(e=new s),f(b,d,i,r,e)):y?(e||(e=new s),ae(n,t,i,r,f,e)):!1}function se(n){if(!vr(n)||we(n))return!1;var t=lr(n)?pu:nu;return t.test(a(n))}function he(n){return d(n)&&ar(n.length)&&!!r[b(n)]}function ce(n){var i,t;if(!be(n))return ku(n);i=[];for(t in Object(n))u.call(n,t)&&t!="constructor"&&i.push(t);return i}function er(n,t,i,r,u,f){var y=i&g,c=n.length,p=t.length,l,e,s,v;if(c!=p&&!(y&&p>c))return!1;if(l=f.get(n),l&&f.get(t))return l==t;var o=-1,h=!0,a=i&ni?new et:undefined;for(f.set(n,t),f.set(t,n);++o<c;){if(e=n[o],s=t[o],r&&(v=y?r(s,e,o,t,n,f):r(e,s,o,n,t,f)),v!==undefined){if(v)continue;h=!1;break}if(a){if(!fu(t,function(n,t){if(!su(a,t)&&(e===n||u(e,n,i,r,f)))return a.push(t)})){h=!1;break}}else if(!(e===s||u(e,s,i,r,f))){h=!1;break}}return f["delete"](n),f["delete"](t),h}function le(n,t,i,r,u,f,e){var o,h,s,c;switch(i){case rt:if(n.byteLength!=t.byteLength||n.byteOffset!=t.byteOffset)return!1;n=n.buffer;t=t.buffer;case ci:return n.byteLength!=t.byteLength||!f(new nr(n),new nr(t))?!1:!0;case ii:case ri:case ei:return hr(+n,+t);case ui:return n.name==t.name&&n.message==t.message;case si:case hi:return n==t+"";case tt:o=cu;case it:return(h=r&g,o||(o=au),n.size!=t.size&&!h)?!1:(s=e.get(n),s)?s==t:(r|=ni,e.set(n,t),c=er(o(n),o(t),r,u,f,e),e["delete"](n),c);case dr:if(dt)return dt.call(n)==dt.call(t)}return!1}function ae(n,t,i,r,f,e){var y=i&g,w=or(n),b=w.length,nt=or(t),tt=nt.length,s,o,k,h,p,c,l,d,a,v;if(b!=tt&&!y)return!1;for(s=b;s--;)if(o=w[s],!(y?o in t:u.call(t,o)))return!1;if(k=e.get(n),k&&e.get(t))return k==t;for(h=!0,e.set(n,t),e.set(t,n),p=y;++s<b;){if(o=w[s],c=n[o],l=t[o],r&&(d=y?r(l,c,o,t,n,e):r(c,l,o,n,t,e)),!(d===undefined?c===l||f(c,l,i,r,e):d)){h=!1;break}p||(p=o=="constructor")}return h&&!p&&(a=n.constructor,v=t.constructor,a!=v&&"constructor"in n&&"constructor"in t&&!(typeof a=="function"&&a instanceof a&&typeof v=="function"&&v instanceof v)&&(h=!1)),e["delete"](n),e["delete"](t),h}function or(n){return ee(n,no,sr)}function st(n,t){var i=n.__data__;return pe(t)?i[typeof t=="string"?"string":"hash"]:i.map}function y(n,t){var i=hu(n,t);return se(i)?i:undefined}function ve(n){var r=u.call(n,h),f=n[h],t,i;try{n[h]=undefined;t=!0}catch(e){}return i=di.call(n),t&&(r?n[h]=f:delete n[h]),i}function ye(n,t){return t=t==null?ti:t,!!t&&(typeof n=="number"||tu.test(n))&&n>-1&&n%1==0&&n<t}function pe(n){var t=typeof n;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?n!=="__proto__":n===null}function we(n){return!!ki&&ki in n}function be(n){var t=n&&n.constructor,i=typeof t=="function"&&t.prototype||ut;return n===i}function ke(n){return di.call(n)}function a(n){if(n!=null){try{return bi.call(n)}catch(t){}try{return n+""}catch(t){}}return""}function hr(n,t){return n===t||n!==n&&t!==t}function de(n){return n!=null&&ar(n.length)&&!lr(n)}function ge(n,t){return fr(n,t)}function lr(n){if(!vr(n))return!1;var t=b(n);return t==fi||t==wr||t==pr||t==kr}function ar(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=ti}function vr(n){var t=typeof n;return n!=null&&(t=="object"||t=="function")}function d(n){return n!=null&&typeof n=="object"}function no(n){return de(n)?fe(n):ce(n)}function to(){return[]}function io(){return!1}var yr=200,ct="__lodash_hash_undefined__",g=1,ni=2,ti=9007199254740991,nt="[object Arguments]",lt="[object Array]",pr="[object AsyncFunction]",ii="[object Boolean]",ri="[object Date]",ui="[object Error]",fi="[object Function]",wr="[object GeneratorFunction]",tt="[object Map]",ei="[object Number]",br="[object Null]",v="[object Object]",oi="[object Promise]",kr="[object Proxy]",si="[object RegExp]",it="[object Set]",hi="[object String]",dr="[object Symbol]",gr="[object Undefined]",at="[object WeakMap]",ci="[object ArrayBuffer]",rt="[object DataView]",nu=/^\[object .+?Constructor\]$/,tu=/^(?:0|[1-9]\d*)$/,r={},sr,o,cr,k,ht,gt;r["[object Float32Array]"]=r["[object Float64Array]"]=r["[object Int8Array]"]=r["[object Int16Array]"]=r["[object Int32Array]"]=r["[object Uint8Array]"]=r["[object Uint8ClampedArray]"]=r["[object Uint16Array]"]=r["[object Uint32Array]"]=!0;r[nt]=r[lt]=r[ci]=r[ii]=r[rt]=r[ri]=r[ui]=r[fi]=r[tt]=r[ei]=r[v]=r[si]=r[it]=r[hi]=r[at]=!1;var li=typeof n=="object"&&n&&n.Object===Object&&n,iu=typeof self=="object"&&self&&self.Object===Object&&self,f=li||iu||Function("return this")(),ai=typeof i=="object"&&i&&!i.nodeType&&i,vi=ai&&typeof t=="object"&&t&&!t.nodeType&&t,yi=vi&&vi.exports===ai,vt=yi&&li.process,pi=function(){try{return vt&&vt.binding&&vt.binding("util")}catch(n){}}(),wi=pi&&pi.isTypedArray;var vu=Array.prototype,yu=Function.prototype,ut=Object.prototype,yt=f["__core-js_shared__"],bi=yu.toString,u=ut.hasOwnProperty,ki=function(){var n=/[^.]+$/.exec(yt&&yt.keys&&yt.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}(),di=ut.toString,pu=RegExp("^"+bi.call(u).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),gi=yi?f.Buffer:undefined,ft=f.Symbol,nr=f.Uint8Array,tr=ut.propertyIsEnumerable,wu=vu.splice,h=ft?ft.toStringTag:undefined,ir=Object.getOwnPropertySymbols,bu=gi?gi.isBuffer:undefined,ku=lu(Object.keys,Object),pt=y(f,"DataView"),p=y(f,"Map"),wt=y(f,"Promise"),bt=y(f,"Set"),kt=y(f,"WeakMap"),w=y(Object,"create"),du=a(pt),gu=a(p),nf=a(wt),tf=a(bt),rf=a(kt),rr=ft?ft.prototype:undefined,dt=rr?rr.valueOf:undefined;c.prototype.clear=uf;c.prototype["delete"]=ff;c.prototype.get=ef;c.prototype.has=of;c.prototype.set=sf;e.prototype.clear=hf;e.prototype["delete"]=cf;e.prototype.get=lf;e.prototype.has=af;e.prototype.set=vf;l.prototype.clear=yf;l.prototype["delete"]=pf;l.prototype.get=wf;l.prototype.has=bf;l.prototype.set=kf;et.prototype.add=et.prototype.push=df;et.prototype.has=gf;s.prototype.clear=ne;s.prototype["delete"]=te;s.prototype.get=ie;s.prototype.has=re;s.prototype.set=ue;sr=ir?function(n){return n==null?[]:(n=Object(n),ru(ir(n),function(t){return tr.call(n,t)}))}:to;o=b;(pt&&o(new pt(new ArrayBuffer(1)))!=rt||p&&o(new p)!=tt||wt&&o(wt.resolve())!=oi||bt&&o(new bt)!=it||kt&&o(new kt)!=at)&&(o=function(n){var t=b(n),i=t==v?n.constructor:undefined,r=i?a(i):"";if(r)switch(r){case du:return rt;case gu:return tt;case nf:return oi;case tf:return it;case rf:return at}return t});cr=ur(function(){return arguments}())?ur:function(n){return d(n)&&u.call(n,"callee")&&!tr.call(n,"callee")};k=Array.isArray;ht=bu||io;gt=wi?ou(wi):he;t.exports=ge}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],17:[function(n,t,i){(function(n){function u(n,t){for(var u,r=0,i=n.length-1;i>=0;i--)u=n[i],u==="."?n.splice(i,1):u===".."?(n.splice(i,1),r++):r&&(n.splice(i,1),r--);if(t)for(;r--;r)n.unshift("..");return n}function r(n,t){var r,i;if(n.filter)return n.filter(t);for(r=[],i=0;i<n.length;i++)t(n[i],i,n)&&r.push(n[i]);return r}var e=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,t=function(n){return e.exec(n).slice(1)},f;i.resolve=function(){for(var i,t="",f=!1,e=arguments.length-1;e>=-1&&!f;e--){if(i=e>=0?arguments[e]:n.cwd(),typeof i!="string")throw new TypeError("Arguments to path.resolve must be strings");else if(!i)continue;t=i+"/"+t;f=i.charAt(0)==="/"}return t=u(r(t.split("/"),function(n){return!!n}),!f).join("/"),(f?"/":"")+t||"."};i.normalize=function(n){var t=i.isAbsolute(n),e=f(n,-1)==="/";return n=u(r(n.split("/"),function(n){return!!n}),!t).join("/"),n||t||(n="."),n&&e&&(n+="/"),(t?"/":"")+n};i.isAbsolute=function(n){return n.charAt(0)==="/"};i.join=function(){var n=Array.prototype.slice.call(arguments,0);return i.normalize(r(n,function(n){if(typeof n!="string")throw new TypeError("Arguments to path.join must be strings");return n}).join("/"))};i.relative=function(n,t){function s(n){for(var t=0,i;t<n.length;t++)if(n[t]!=="")break;for(i=n.length-1;i>=0;i--)if(n[i]!=="")break;return t>i?[]:n.slice(t,i-t+1)}var u,r;n=i.resolve(n).substr(1);t=i.resolve(t).substr(1);var f=s(n.split("/")),e=s(t.split("/")),h=Math.min(f.length,e.length),o=h;for(r=0;r<h;r++)if(f[r]!==e[r]){o=r;break}for(u=[],r=o;r<f.length;r++)u.push("..");return u=u.concat(e.slice(o)),u.join("/")};i.sep="/";i.delimiter=":";i.dirname=function(n){var r=t(n),u=r[0],i=r[1];return!u&&!i?".":(i&&(i=i.substr(0,i.length-1)),u+i)};i.basename=function(n,i){var r=t(n)[2];return i&&r.substr(-1*i.length)===i&&(r=r.substr(0,r.length-i.length)),r};i.extname=function(n){return t(n)[3]};f="ab".substr(-1)==="b"?function(n,t,i){return n.substr(t,i)}:function(n,t,i){return t<0&&(t=n.length+t),n.substr(t,i)}}).call(this,n("_process"))},{_process:18}],18:[function(n,t){function c(){throw new Error("setTimeout has not been defined");}function l(){throw new Error("clearTimeout has not been defined");}function a(n){if(r===setTimeout)return setTimeout(n,0);if((r===c||!r)&&setTimeout)return r=setTimeout,setTimeout(n,0);try{return r(n,0)}catch(t){try{return r.call(null,n,0)}catch(t){return r.call(this,n,0)}}}function p(n){if(u===clearTimeout)return clearTimeout(n);if((u===l||!u)&&clearTimeout)return u=clearTimeout,clearTimeout(n);try{return u(n)}catch(t){try{return u.call(null,n)}catch(t){return u.call(this,n)}}}function w(){s&&o&&(s=!1,o.length?f=o.concat(f):h=-1,f.length&&v())}function v(){var t,n;if(!s){for(t=a(w),s=!0,n=f.length;n;){for(o=f,f=[];++h<n;)o&&o[h].run();h=-1;n=f.length}o=null;s=!1;p(t)}}function y(n,t){this.fun=n;this.array=t}function e(){}var i=t.exports={},r,u;(function(){try{r=typeof setTimeout=="function"?setTimeout:c}catch(n){r=c}try{u=typeof clearTimeout=="function"?clearTimeout:l}catch(n){u=l}})();var f=[],s=!1,o,h=-1;i.nextTick=function(n){var i=new Array(arguments.length-1),t;if(arguments.length>1)for(t=1;t<arguments.length;t++)i[t-1]=arguments[t];f.push(new y(n,i));f.length!==1||s||a(v)};y.prototype.run=function(){this.fun.apply(null,this.array)};i.title="browser";i.browser=!0;i.env={};i.argv=[];i.version="";i.versions={};i.on=e;i.addListener=e;i.once=e;i.off=e;i.removeListener=e;i.removeAllListeners=e;i.emit=e;i.prependListener=e;i.prependOnceListener=e;i.listeners=function(){return[]};i.binding=function(){throw new Error("process.binding is not supported");};i.cwd=function(){return"/"};i.chdir=function(){throw new Error("process.chdir is not supported");};i.umask=function(){return 0}},{}],19:[function(n,t){function i(n){this.value=n}function s(n,t,i){var s=[],r=[],c=!0;return function l(n){function w(){if(typeof a.node=="object"&&a.node!==null){a.keys&&a.node_===a.node||(a.keys=u(a.node));a.isLeaf=a.keys.length==0;for(var t=0;t<r.length;t++)if(r[t].node_===n){a.circular=r[t];break}}else a.isLeaf=!0,a.keys=null;a.notLeaf=!a.isLeaf;a.notRoot=!a.isRoot}var b=i?h(n):n,v={},y=!0,a={node:b,node_:n,path:[].concat(s),parent:r[r.length-1],parents:r,key:s.slice(-1)[0],isRoot:s.length===0,level:s.length,circular:null,update:function(n,t){a.isRoot||(a.parent.node[a.key]=n);a.node=n;t&&(y=!1)},"delete":function(n){delete a.parent.node[a.key];n&&(y=!1)},remove:function(n){o(a.parent.node)?a.parent.node.splice(a.key,1):delete a.parent.node[a.key];n&&(y=!1)},keys:null,before:function(n){v.before=n},after:function(n){v.after=n},pre:function(n){v.pre=n},post:function(n){v.post=n},stop:function(){c=!1},block:function(){y=!1}},p;return c?(w(),p=t.call(a,a.node),p!==undefined&&a.update&&a.update(p),v.before&&v.before.call(a,a.node),!y)?a:(typeof a.node!="object"||a.node===null||a.circular||(r.push(a),w(),f(a.keys,function(n,t){s.push(n);v.pre&&v.pre.call(a,a.node[n],n);var r=l(a.node[n]);i&&e.call(a.node,n)&&(a.node[n]=r.node);r.isLast=t==a.keys.length-1;r.isFirst=t==0;v.post&&v.post.call(a,r);s.pop()}),r.pop()),v.after&&v.after.call(a,a.node),a):a}(n).node}function h(n){var t,r,i;return typeof n=="object"&&n!==null?(o(n)?t=[]:l(n)?t=new Date(n.getTime?n.getTime():n):a(n)?t=new RegExp(n):v(n)?t={message:n.message}:y(n)?t=new Boolean(n):p(n)?t=new Number(n):w(n)?t=new String(n):Object.create&&Object.getPrototypeOf?t=Object.create(Object.getPrototypeOf(n)):n.constructor===Object?t={}:(r=n.constructor&&n.constructor.prototype||n.__proto__||{},i=function(){},i.prototype=r,t=new i),f(u(n),function(i){t[i]=n[i]}),t):n}function r(n){return Object.prototype.toString.call(n)}function l(n){return r(n)==="[object Date]"}function a(n){return r(n)==="[object RegExp]"}function v(n){return r(n)==="[object Error]"}function y(n){return r(n)==="[object Boolean]"}function p(n){return r(n)==="[object Number]"}function w(n){return r(n)==="[object String]"}var c=t.exports=function(n){return new i(n)},u,o,f,e;i.prototype.get=function(n){for(var r,t=this.value,i=0;i<n.length;i++){if(r=n[i],!t||!e.call(t,r)){t=undefined;break}t=t[r]}return t};i.prototype.has=function(n){for(var r,t=this.value,i=0;i<n.length;i++){if(r=n[i],!t||!e.call(t,r))return!1;t=t[r]}return!0};i.prototype.set=function(n,t){for(var u,i=this.value,r=0;r<n.length-1;r++)u=n[r],e.call(i,u)||(i[u]={}),i=i[u];return i[n[r]]=t,t};i.prototype.map=function(n){return s(this.value,n,!0)};i.prototype.forEach=function(n){return this.value=s(this.value,n,!1),this.value};i.prototype.reduce=function(n,t){var r=arguments.length===1,i=r?this.value:t;return this.forEach(function(t){this.isRoot&&r||(i=n.call(this,i,t))}),i};i.prototype.paths=function(){var n=[];return this.forEach(function(){n.push(this.path)}),n};i.prototype.nodes=function(){var n=[];return this.forEach(function(){n.push(this.node)}),n};i.prototype.clone=function(){var n=[],t=[];return function i(r){for(var o,e=0;e<n.length;e++)if(n[e]===r)return t[e];return typeof r=="object"&&r!==null?(o=h(r),n.push(r),t.push(o),f(u(r),function(n){o[n]=i(r[n])}),n.pop(),t.pop(),o):r}(this.value)};u=Object.keys||function(n){var t=[];for(var i in n)t.push(i);return t};o=Array.isArray||function(n){return Object.prototype.toString.call(n)==="[object Array]"};f=function(n,t){if(n.forEach)return n.forEach(t);for(var i=0;i<n.length;i++)t(n[i],i,n)};f(u(i.prototype),function(n){c[n]=function(t){var u=[].slice.call(arguments,1),r=new i(t);return r[n].apply(r,u)}});e=Object.hasOwnProperty||function(n,t){return t in n}},{}],20:[function(n,t){t.exports.RADIUS=6378137;t.exports.FLATTENING=1/298.257223563;t.exports.POLAR_RADIUS=6356752.3142},{}],21:[function(n,t){function r(){for(var n,t,u={},r=0;r<arguments.length;r++){n=arguments[r];for(t in n)i.call(n,t)&&(u[t]=n[t])}return u}t.exports=r;var i=Object.prototype.hasOwnProperty},{}],22:[function(n,t){"use strict";var r=n("lodash.isequal"),u=n("@mapbox/geojson-normalize"),f=n("hat"),e=n("./lib/features_at"),o=n("./lib/string_sets_are_equal"),s=n("@mapbox/geojsonhint"),i=n("./constants"),h=n("./lib/string_set"),c={Polygon:n("./feature_types/polygon"),LineString:n("./feature_types/line_string"),Point:n("./feature_types/point"),MultiPolygon:n("./feature_types/multi_feature"),MultiLineString:n("./feature_types/multi_feature"),MultiPoint:n("./feature_types/multi_feature")};t.exports=function(n,t){return t.modes=i.modes,t.getFeatureIdsAt=function(t){var i=e.click({point:t},null,n);return i.map(function(n){return n.properties.id})},t.getSelectedIds=function(){return n.store.getSelectedIds()},t.getSelected=function(){return{type:i.geojsonTypes.FEATURE_COLLECTION,features:n.store.getSelectedIds().map(function(t){return n.store.get(t)}).map(function(n){return n.toGeoJSON()})}},t.getSelectedPoints=function(){return{type:i.geojsonTypes.FEATURE_COLLECTION,features:n.store.getSelectedCoordinates().map(function(n){return{type:i.geojsonTypes.FEATURE,properties:{},geometry:{type:i.geojsonTypes.POINT,coordinates:n.coordinates}}})}},t.set=function(r){if(r.type===undefined||r.type!==i.geojsonTypes.FEATURE_COLLECTION||!Array.isArray(r.features))throw new Error("Invalid FeatureCollection");var e=n.store.createRenderBatch(),u=n.store.getAllIds().slice(),f=t.add(r),o=new h(f);return u=u.filter(function(n){return!o.has(n)}),u.length&&t.delete(u),e(),f},t.add=function(t){var i=s.hint(t,{precisionWarning:!1}).filter(function(n){return n.level!=="message"}),e,o;if(i.length)throw new Error(i[0].message);return e=JSON.parse(JSON.stringify(u(t))),o=e.features.map(function(t){var u,e,i;if(t.id=t.id||f(),t.geometry===null)throw new Error("Invalid geometry: null");if(n.store.get(t.id)===undefined||n.store.get(t.id).type!==t.geometry.type){if(u=c[t.geometry.type],u===undefined)throw new Error("Invalid geometry type: ".concat(t.geometry.type,"."));e=new u(n,t);n.store.add(e)}else i=n.store.get(t.id),i.properties=t.properties,r(i.getCoordinates(),t.geometry.coordinates)||i.incomingCoords(t.geometry.coordinates);return t.id}),n.store.render(),o},t.get=function(t){var i=n.store.get(t);if(i)return i.toGeoJSON()},t.getAll=function(){return{type:i.geojsonTypes.FEATURE_COLLECTION,features:n.store.getAll().map(function(n){return n.toGeoJSON()})}},t.delete=function(r){return n.store.delete(r,{silent:!0}),t.getMode()!==i.modes.DIRECT_SELECT||n.store.getSelectedIds().length?n.store.render():n.events.changeMode(i.modes.SIMPLE_SELECT,undefined,{silent:!0}),t},t.deleteAll=function(){return n.store.delete(n.store.getAllIds(),{silent:!0}),t.getMode()===i.modes.DIRECT_SELECT?n.events.changeMode(i.modes.SIMPLE_SELECT,undefined,{silent:!0}):n.store.render(),t},t.changeMode=function(r){var u=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return r===i.modes.SIMPLE_SELECT&&t.getMode()===i.modes.SIMPLE_SELECT?o(u.featureIds||[],n.store.getSelectedIds())?t:(n.store.setSelected(u.featureIds,{silent:!0}),n.store.render(),t):r===i.modes.DIRECT_SELECT&&t.getMode()===i.modes.DIRECT_SELECT&&u.featureId===n.store.getSelectedIds()[0]?t:(n.events.changeMode(r,u,{silent:!0}),t)},t.getMode=function(){return n.events.getMode()},t.trash=function(){return n.events.trash({silent:!0}),t},t.combineFeatures=function(){return n.events.combineFeatures({silent:!0}),t},t.uncombineFeatures=function(){return n.events.uncombineFeatures({silent:!0}),t},t.setFeatureProperty=function(i,r,u){return n.store.setFeatureProperty(i,r,u),t},t}},{"./constants":23,"./feature_types/line_string":26,"./feature_types/multi_feature":27,"./feature_types/point":28,"./feature_types/polygon":29,"./lib/features_at":37,"./lib/string_set":47,"./lib/string_sets_are_equal":48,"@mapbox/geojson-normalize":7,"@mapbox/geojsonhint":8,hat:14,"lodash.isequal":16}],23:[function(n,t){"use strict";t.exports={classes:{CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},sources:{HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},cursors:{ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},types:{POLYGON:"polygon",LINE:"line_string",POINT:"point"},geojsonTypes:{FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},modes:{DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},events:{CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},updateActions:{MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},meta:{FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},activeStates:{ACTIVE:"true",INACTIVE:"false"},interactions:["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],LAT_MIN:-90,LAT_RENDERED_MIN:-85,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}},{}],24:[function(n,t){"use strict";var u=n("./lib/mode_handler"),r=n("./lib/get_features_and_set_cursor"),f=n("./lib/features_at"),e=n("./lib/is_click"),o=n("./lib/is_tap"),i=n("./constants"),s=n("./modes/object_to_mode");t.exports=function(n){function a(t,r){var o=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{},f,e;if(h.stop(),f=w[t],f===undefined)throw new Error("".concat(t," is not valid"));c=t;e=f(n,r);h=u(e,n);o.silent||n.map.fire(i.events.MODE_CHANGE,{mode:t});n.store.setDirty();n.store.render()}function b(t){var r=!1;Object.keys(t).forEach(function(n){if(l[n]===undefined)throw new Error("Invalid action type");l[n]!==t[n]&&(r=!0);l[n]=t[n]});r&&n.map.fire(i.events.ACTIONABLE,{actions:l})}var w=Object.keys(n.options.modes).reduce(function(t,i){return t[i]=s(n.options.modes[i]),t},{}),v={},y={},t={},c=null,h=null,p,l;return t.drag=function(t,r){r({point:t.point,time:(new Date).getTime()})?(n.ui.queueMapClasses({mouse:i.cursors.DRAG}),h.drag(t)):t.originalEvent.stopPropagation()},t.mousedrag=function(n){t.drag(n,function(n){return!e(v,n)})},t.touchdrag=function(n){t.drag(n,function(n){return!o(y,n)})},t.mousemove=function(i){var f=i.originalEvent.buttons!==undefined?i.originalEvent.buttons:i.originalEvent.which,u;if(f===1)return t.mousedrag(i);u=r(i,n);i.featureTarget=u;h.mousemove(i)},t.mousedown=function(t){v={time:(new Date).getTime(),point:t.point};var i=r(t,n);t.featureTarget=i;h.mousedown(t)},t.mouseup=function(t){var i=r(t,n);t.featureTarget=i;e(v,{point:t.point,time:(new Date).getTime()})?h.click(t):h.mouseup(t)},t.mouseout=function(n){h.mouseout(n)},t.touchstart=function(t){if(t.originalEvent.preventDefault(),n.options.touchEnabled){y={time:(new Date).getTime(),point:t.point};var i=f.touch(t,null,n)[0];t.featureTarget=i;h.touchstart(t)}},t.touchmove=function(i){if(i.originalEvent.preventDefault(),n.options.touchEnabled)return h.touchmove(i),t.touchdrag(i)},t.touchend=function(t){if(t.originalEvent.preventDefault(),n.options.touchEnabled){var i=f.touch(t,null,n)[0];t.featureTarget=i;o(y,{time:(new Date).getTime(),point:t.point})?h.tap(t):h.touchend(t)}},p=function(n){return!(n===8||n===46||n>=48&&n<=57)},t.keydown=function(t){(t.srcElement||t.target).classList[0]==="mapboxgl-canvas"&&((t.keyCode===8||t.keyCode===46)&&n.options.controls.trash?(t.preventDefault(),h.trash()):p(t.keyCode)?h.keydown(t):t.keyCode===49&&n.options.controls.point?a(i.modes.DRAW_POINT):t.keyCode===50&&n.options.controls.line_string?a(i.modes.DRAW_LINE_STRING):t.keyCode===51&&n.options.controls.polygon&&a(i.modes.DRAW_POLYGON))},t.keyup=function(n){p(n.keyCode)&&h.keyup(n)},t.zoomend=function(){n.store.changeZoom()},t.data=function(t){if(t.dataType==="style"){var r=n.setup,u=n.map,f=n.options,i=n.store,e=f.styles.some(function(n){return u.getLayer(n.id)});e||(r.addLayers(),i.setDirty(),i.render())}},l={trash:!1,combineFeatures:!1,uncombineFeatures:!1},{start:function(){c=n.options.defaultMode;h=u(w[c](n),n)},changeMode:a,actionable:b,currentModeName:function(){return c},currentModeRender:function(n,t){return h.render(n,t)},fire:function(n,i){t[n]&&t[n](i)},addEventListeners:function(){n.map.on("mousemove",t.mousemove);n.map.on("mousedown",t.mousedown);n.map.on("mouseup",t.mouseup);n.map.on("data",t.data);n.map.on("touchmove",t.touchmove);n.map.on("touchstart",t.touchstart);n.map.on("touchend",t.touchend);n.container.addEventListener("mouseout",t.mouseout);n.options.keybindings&&(n.container.addEventListener("keydown",t.keydown),n.container.addEventListener("keyup",t.keyup))},removeEventListeners:function(){n.map.off("mousemove",t.mousemove);n.map.off("mousedown",t.mousedown);n.map.off("mouseup",t.mouseup);n.map.off("data",t.data);n.map.off("touchmove",t.touchmove);n.map.off("touchstart",t.touchstart);n.map.off("touchend",t.touchend);n.container.removeEventListener("mouseout",t.mouseout);n.options.keybindings&&(n.container.removeEventListener("keydown",t.keydown),n.container.removeEventListener("keyup",t.keyup))},trash:function(n){h.trash(n)},combineFeatures:function(){h.combineFeatures()},uncombineFeatures:function(){h.uncombineFeatures()},getMode:function(){return c}}}},{"./constants":23,"./lib/features_at":37,"./lib/get_features_and_set_cursor":38,"./lib/is_click":39,"./lib/is_tap":41,"./lib/mode_handler":43,"./modes/object_to_mode":59}],25:[function(n,t){"use strict";var u=n("hat"),r=n("../constants"),i=function(n,t){this.ctx=n;this.properties=t.properties||{};this.coordinates=t.geometry.coordinates;this.id=t.id||u();this.type=t.geometry.type};i.prototype.changed=function(){this.ctx.store.featureChanged(this.id)};i.prototype.incomingCoords=function(n){this.setCoordinates(n)};i.prototype.setCoordinates=function(n){this.coordinates=n;this.changed()};i.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))};i.prototype.setProperty=function(n,t){this.properties[n]=t};i.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:r.geojsonTypes.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))};i.prototype.internal=function(n){var i={id:this.id,meta:r.meta.FEATURE,"meta:type":this.type,active:r.activeStates.INACTIVE,mode:n},t;if(this.ctx.options.userProperties)for(t in this.properties)i["user_".concat(t)]=this.properties[t];return{type:r.geojsonTypes.FEATURE,properties:i,geometry:{coordinates:this.getCoordinates(),type:this.type}}};t.exports=i},{"../constants":23,hat:14}],26:[function(n,t){"use strict";var r=n("./feature"),i=function(n,t){r.call(this,n,t)};i.prototype=Object.create(r.prototype);i.prototype.isValid=function(){return this.coordinates.length>1};i.prototype.addCoordinate=function(n,t,i){this.changed();var r=parseInt(n,10);this.coordinates.splice(r,0,[t,i])};i.prototype.getCoordinate=function(n){var t=parseInt(n,10);return JSON.parse(JSON.stringify(this.coordinates[t]))};i.prototype.removeCoordinate=function(n){this.changed();this.coordinates.splice(parseInt(n,10),1)};i.prototype.updateCoordinate=function(n,t,i){var r=parseInt(n,10);this.coordinates[r]=[t,i];this.changed()};t.exports=i},{"./feature":25}],27:[function(n,t){"use strict";var u=n("./feature"),f=n("../constants"),e=n("hat"),o={MultiPoint:n("./point"),MultiLineString:n("./line_string"),MultiPolygon:n("./polygon")},r=function(n,t,i,r,u){var f=i.split("."),e=parseInt(f[0],10),o=f[1]?f.slice(1).join("."):null;return n[e][t](o,r,u)},i=function(n,t){if(u.call(this,n,t),delete this.coordinates,this.model=o[t.geometry.type],this.model===undefined)throw new TypeError("".concat(t.geometry.type," is not a valid type"));this.features=this._coordinatesToFeatures(t.geometry.coordinates)};i.prototype=Object.create(u.prototype);i.prototype._coordinatesToFeatures=function(n){var t=this,i=this.model.bind(this);return n.map(function(n){return new i(t.ctx,{id:e(),type:f.geojsonTypes.FEATURE,properties:{},geometry:{coordinates:n,type:t.type.replace("Multi","")}})})};i.prototype.isValid=function(){return this.features.every(function(n){return n.isValid()})};i.prototype.setCoordinates=function(n){this.features=this._coordinatesToFeatures(n);this.changed()};i.prototype.getCoordinate=function(n){return r(this.features,"getCoordinate",n)};i.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(n){return n.type===f.geojsonTypes.POLYGON?n.getCoordinates():n.coordinates})))};i.prototype.updateCoordinate=function(n,t,i){r(this.features,"updateCoordinate",n,t,i);this.changed()};i.prototype.addCoordinate=function(n,t,i){r(this.features,"addCoordinate",n,t,i);this.changed()};i.prototype.removeCoordinate=function(n){r(this.features,"removeCoordinate",n);this.changed()};i.prototype.getFeatures=function(){return this.features};t.exports=i},{"../constants":23,"./feature":25,"./line_string":26,"./point":28,"./polygon":29,hat:14}],28:[function(n,t){"use strict";var r=n("./feature"),i=function(n,t){r.call(this,n,t)};i.prototype=Object.create(r.prototype);i.prototype.isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"};i.prototype.updateCoordinate=function(n,t,i){this.coordinates=arguments.length===3?[t,i]:[n,t];this.changed()};i.prototype.getCoordinate=function(){return this.getCoordinates()};t.exports=i},{"./feature":25}],29:[function(n,t){"use strict";var r=n("./feature"),i=function(n,t){r.call(this,n,t);this.coordinates=this.coordinates.map(function(n){return n.slice(0,-1)})};i.prototype=Object.create(r.prototype);i.prototype.isValid=function(){return this.coordinates.length===0?!1:this.coordinates.every(function(n){return n.length>2})};i.prototype.incomingCoords=function(n){this.coordinates=n.map(function(n){return n.slice(0,-1)});this.changed()};i.prototype.setCoordinates=function(n){this.coordinates=n;this.changed()};i.prototype.addCoordinate=function(n,t,i){this.changed();var r=n.split(".").map(function(n){return parseInt(n,10)}),u=this.coordinates[r[0]];u.splice(r[1],0,[t,i])};i.prototype.removeCoordinate=function(n){this.changed();var t=n.split(".").map(function(n){return parseInt(n,10)}),i=this.coordinates[t[0]];i&&(i.splice(t[1],1),i.length<3&&this.coordinates.splice(t[0],1))};i.prototype.getCoordinate=function(n){var t=n.split(".").map(function(n){return parseInt(n,10)}),i=this.coordinates[t[0]];return JSON.parse(JSON.stringify(i[t[1]]))};i.prototype.getCoordinates=function(){return this.coordinates.map(function(n){return n.concat([n[0]])})};i.prototype.updateCoordinate=function(n,t,i){this.changed();var u=n.split("."),r=parseInt(u[0],10),f=parseInt(u[1],10);this.coordinates[r]===undefined&&(this.coordinates[r]=[]);this.coordinates[r][f]=[t,i]};t.exports=i},{"./feature":25}],30:[function(n,t){"use strict";var i=n("../constants");t.exports={isOfMetaType:function(n){return function(t){var i=t.featureTarget;return i?i.properties?i.properties.meta===n:!1:!1}},isShiftMousedown:function(n){return n.originalEvent?n.originalEvent.shiftKey?n.originalEvent.button===0:!1:!1},isActiveFeature:function(n){return n.featureTarget?n.featureTarget.properties?n.featureTarget.properties.active===i.activeStates.ACTIVE&&n.featureTarget.properties.meta===i.meta.FEATURE:!1:!1},isInactiveFeature:function(n){return n.featureTarget?n.featureTarget.properties?n.featureTarget.properties.active===i.activeStates.INACTIVE&&n.featureTarget.properties.meta===i.meta.FEATURE:!1:!1},noTarget:function(n){return n.featureTarget===undefined},isFeature:function(n){return n.featureTarget?n.featureTarget.properties?n.featureTarget.properties.meta===i.meta.FEATURE:!1:!1},isVertex:function(n){var t=n.featureTarget;return t?t.properties?t.properties.meta===i.meta.VERTEX:!1:!1},isShiftDown:function(n){return n.originalEvent?n.originalEvent.shiftKey===!0:!1},isEscapeKey:function(n){return n.keyCode===27},isEnterKey:function(n){return n.keyCode===13},"true":function(){return!0}}},{"../constants":23}],31:[function(n,t){"use strict";var h=n("@mapbox/geojson-extent"),i=n("../constants"),r=i.LAT_MIN,u=i.LAT_MAX,f=i.LAT_RENDERED_MIN,e=i.LAT_RENDERED_MAX,o=i.LNG_MIN,s=i.LNG_MAX;t.exports=function(n,t){var c=r,l=u,a=r,v=u,y=s,p=o,i;return n.forEach(function(n){var t=h(n),i=t[1],r=t[3],u=t[0],f=t[2];i>c&&(c=i);r<l&&(l=r);r>a&&(a=r);i<v&&(v=i);u<y&&(y=u);f>p&&(p=f)}),i=t,c+i.lat>e&&(i.lat=e-c),a+i.lat>u&&(i.lat=u-a),l+i.lat<f&&(i.lat=f-l),v+i.lat<r&&(i.lat=r-v),y+i.lng<=o&&(i.lng+=Math.ceil(Math.abs(i.lng)/360)*360),p+i.lng>=s&&(i.lng-=Math.ceil(Math.abs(i.lng)/360)*360),i}},{"../constants":23,"@mapbox/geojson-extent":6}],32:[function(n,t){"use strict";var i=n("../constants");t.exports=function(n,t,r,u){var f=t.geometry.coordinates,e=r.geometry.coordinates;if(f[1]>i.LAT_RENDERED_MAX||f[1]<i.LAT_RENDERED_MIN||e[1]>i.LAT_RENDERED_MAX||e[1]<i.LAT_RENDERED_MIN)return null;var s=u.project([f[0],f[1]]),h=u.project([e[0],e[1]]),o=u.unproject([(s.x+h.x)/2,(s.y+h.y)/2]);return{type:i.geojsonTypes.FEATURE,properties:{meta:i.meta.MIDPOINT,parent:n,lng:o.lng,lat:o.lat,coord_path:r.properties.coord_path},geometry:{type:i.geojsonTypes.POINT,coordinates:[o.lng,o.lat]}}}},{"../constants":23}],33:[function(n,t){"use strict";function u(n){function a(n,i){var o="",u=null;n.forEach(function(n,s){var y=i!==undefined&&i!==null?"".concat(i,".").concat(s):String(s),h=r(c,n,y,v(y)),l,a;e.midpoints&&u&&(l=f(c,u,h,e.map),l&&t.push(l));u=h;a=JSON.stringify(n);o!==a&&t.push(h);s===0&&(o=a)})}function v(n){return e.selectedPaths?e.selectedPaths.indexOf(n)!==-1:!1}function y(){var r=s.replace(i.geojsonTypes.MULTI_PREFIX,"");h.forEach(function(f,o){var s={type:i.geojsonTypes.FEATURE,properties:n.properties,geometry:{type:r,coordinates:f}};t=t.concat(u(s,e,o))})}var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},o=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null,l=n.geometry,s=l.type,h=l.coordinates,c=n.properties&&n.properties.id,t=[];return s===i.geojsonTypes.POINT?t.push(r(c,h,o,v(o))):s===i.geojsonTypes.POLYGON?h.forEach(function(n,t){a(n,o!==null?"".concat(o,".").concat(t):String(t))}):s===i.geojsonTypes.LINE_STRING?a(h,o):s.indexOf(i.geojsonTypes.MULTI_PREFIX)===0&&y(),t}var r=n("./create_vertex"),f=n("./create_midpoint"),i=n("../constants");t.exports=u},{"../constants":23,"./create_midpoint":32,"./create_vertex":34}],34:[function(n,t){"use strict";var i=n("../constants");t.exports=function(n,t,r,u){return{type:i.geojsonTypes.FEATURE,properties:{meta:i.meta.VERTEX,parent:n,coord_path:r,active:u?i.activeStates.ACTIVE:i.activeStates.INACTIVE},geometry:{type:i.geojsonTypes.POINT,coordinates:t}}}},{"../constants":23}],35:[function(n,t){"use strict";t.exports={enable:function(n){setTimeout(function(){n.map&&n.map.doubleClickZoom&&n._ctx&&n._ctx.store&&n._ctx.store.getInitialConfigValue&&n._ctx.store.getInitialConfigValue("doubleClickZoom")&&n.map.doubleClickZoom.enable()},0)},disable:function(n){setTimeout(function(){n.map&&n.map.doubleClickZoom&&n.map.doubleClickZoom.disable()},0)}}},{}],36:[function(n,t){"use strict";t.exports=function(n,t){var i=n.x-t.x,r=n.y-t.y;return Math.sqrt(i*i+r*r)}},{}],37:[function(n,t){"use strict";function s(n,t,i){return r(n,t,i,i.options.clickBuffer)}function h(n,t,i){return r(n,t,i,i.options.touchBuffer)}function r(n,t,i,r){var h,s;if(i.map===null)return[];h=n?f(n,r):t;s={};i.options.styles&&(s.layers=i.options.styles.map(function(n){return n.id}));var a=i.map.queryRenderedFeatures(h,s).filter(function(n){return o.indexOf(n.properties.meta)!==-1}),c=new e,l=[];return a.forEach(function(n){var t=n.properties.id;c.has(t)||(c.add(t),l.push(n))}),u(l)}var u=n("./sort_features"),f=n("./map_event_to_bounding_box"),i=n("../constants"),e=n("./string_set"),o=[i.meta.FEATURE,i.meta.MIDPOINT,i.meta.VERTEX];t.exports={click:s,touch:h}},{"../constants":23,"./map_event_to_bounding_box":42,"./sort_features":46,"./string_set":47}],38:[function(n,t){"use strict";var r=n("./features_at"),i=n("../constants");t.exports=function(n,t){var u=r.click(n,null,t),f={mouse:i.cursors.NONE};return u[0]&&(f.mouse=u[0].properties.active===i.activeStates.ACTIVE?i.cursors.MOVE:i.cursors.POINTER,f.feature=u[0].properties.meta),t.events.currentModeName().indexOf("draw")!==-1&&(f.mouse=i.cursors.ADD),t.ui.queueMapClasses(f),t.ui.updateMapClasses(),u[0]}},{"../constants":23,"./features_at":37}],39:[function(n,t){"use strict";var i=n("./euclidean_distance"),r=4,u=12,f=500;t.exports=function(n,t){var e=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{},s=e.fineTolerance!=null?e.fineTolerance:r,h=e.grossTolerance!=null?e.grossTolerance:u,c=e.interval!=null?e.interval:f,o;return n.point=n.point||t.point,n.time=n.time||t.time,o=i(n.point,t.point),o<s||o<h&&t.time-n.time<c}},{"./euclidean_distance":36}],40:[function(n,t){"use strict";function i(n,t){return n.lngLat?n.lngLat.lng===t[0]&&n.lngLat.lat===t[1]:!1}t.exports=i},{}],41:[function(n,t){"use strict";var i=n("./euclidean_distance"),r=25,u=250;t.exports=function(n,t){var f=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{},o=f.tolerance!=null?f.tolerance:r,s=f.interval!=null?f.interval:u,e;return n.point=n.point||t.point,n.time=n.time||t.time,e=i(n.point,t.point),e<o&&t.time-n.time<s}},{"./euclidean_distance":36}],42:[function(n,t){"use strict";function i(n){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return[[n.point.x-t,n.point.y-t],[n.point.x+t,n.point.y+t]]}t.exports=i},{}],43:[function(n,t){"use strict";var i=function(n,t){var r={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},u={on:function(n,t,i){if(r[n]===undefined)throw new Error("Invalid event type: ".concat(n));r[n].push({selector:t,fn:i})},render:function(n){t.store.featureChanged(n)}},i=function(n,i){for(var e=r[n],o=e.length,f;o--;)if(f=e[o],f.selector(i)){f.fn.call(u,i);t.store.render();t.ui.updateMapClasses();break}};return n.start.call(u),{render:n.render,stop:function(){n.stop&&n.stop()},trash:function(){n.trash&&(n.trash(),t.store.render())},combineFeatures:function(){n.combineFeatures&&n.combineFeatures()},uncombineFeatures:function(){n.uncombineFeatures&&n.uncombineFeatures()},drag:function(n){i("drag",n)},click:function(n){i("click",n)},mousemove:function(n){i("mousemove",n)},mousedown:function(n){i("mousedown",n)},mouseup:function(n){i("mouseup",n)},mouseout:function(n){i("mouseout",n)},keydown:function(n){i("keydown",n)},keyup:function(n){i("keyup",n)},touchstart:function(n){i("touchstart",n)},touchmove:function(n){i("touchmove",n)},touchend:function(n){i("touchend",n)},tap:function(n){i("tap",n)}}};t.exports=i},{}],44:[function(n,t){"use strict";function r(n,t){var r=t.getBoundingClientRect();return new i(n.clientX-r.left-(t.clientLeft||0),n.clientY-r.top-(t.clientTop||0))}var i=n("@mapbox/point-geometry");t.exports=r},{"@mapbox/point-geometry":11}],45:[function(n,t){"use strict";var r=n("./constrain_feature_movement"),i=n("../constants");t.exports=function(n,t){var u=r(n.map(function(n){return n.toGeoJSON()}),t);n.forEach(function(n){var r=n.getCoordinates(),f=function(n){var t={lng:n[0]+u.lng,lat:n[1]+u.lat};return[t.lng,t.lat]},e=function(n){return n.map(function(n){return f(n)})},o=function(n){return n.map(function(n){return e(n)})},t;n.type===i.geojsonTypes.POINT?t=f(r):n.type===i.geojsonTypes.LINE_STRING||n.type===i.geojsonTypes.MULTI_POINT?t=r.map(f):n.type===i.geojsonTypes.POLYGON||n.type===i.geojsonTypes.MULTI_LINE_STRING?t=r.map(e):n.type===i.geojsonTypes.MULTI_POLYGON&&(t=r.map(o));n.incomingCoords(t)})}},{"../constants":23,"./constrain_feature_movement":31}],46:[function(n,t){"use strict";function f(n,t){var u=r[n.geometry.type]-r[t.geometry.type];return u===0&&n.geometry.type===i.geojsonTypes.POLYGON?n.area-t.area:u}function e(n){return n.map(function(n){return n.geometry.type===i.geojsonTypes.POLYGON&&(n.area=u.geometry({type:i.geojsonTypes.FEATURE,property:{},geometry:n.geometry})),n}).sort(f).map(function(n){return delete n.area,n})}var u=n("@mapbox/geojson-area"),i=n("../constants"),r={Point:0,LineString:1,Polygon:2};t.exports=e},{"../constants":23,"@mapbox/geojson-area":3}],47:[function(n,t){"use strict";function i(n){if(this._items={},this._nums={},this._length=n?n.length:0,n)for(var t=0,i=n.length;t<i;t++)(this.add(n[t]),n[t]!==undefined)&&(typeof n[t]=="string"?this._items[n[t]]=t:this._nums[n[t]]=t)}i.prototype.add=function(n){return this.has(n)?this:(this._length++,typeof n=="string"?this._items[n]=this._length:this._nums[n]=this._length,this)};i.prototype.delete=function(n){return this.has(n)===!1?this:(this._length--,delete this._items[n],delete this._nums[n],this)};i.prototype.has=function(n){return typeof n!="string"&&typeof n!="number"?!1:this._items[n]!==undefined||this._nums[n]!==undefined};i.prototype.values=function(){var t=this,n=[];return Object.keys(this._items).forEach(function(i){n.push({k:i,v:t._items[i]})}),Object.keys(this._nums).forEach(function(i){n.push({k:JSON.parse(i),v:t._nums[i]})}),n.sort(function(n,t){return n.v-t.v}).map(function(n){return n.k})};i.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};t.exports=i},{}],48:[function(n,t){"use strict";t.exports=function(n,t){return n.length!==t.length?!1:JSON.stringify(n.map(function(n){return n}).sort())===JSON.stringify(t.map(function(n){return n}).sort())}},{}],49:[function(n,t){"use strict";t.exports=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}]},{}],50:[function(n,t){"use strict";function i(n,t,i){function e(){u=!1;r&&(f.apply(i,r),r=!1)}function f(){u?r=arguments:(u=!0,n.apply(i,arguments),setTimeout(e,t))}var u,r;return f}t.exports=i},{}],51:[function(n,t){"use strict";function i(n){return[].concat(n).filter(function(n){return n!==undefined})}t.exports=i},{}],52:[function(n,t){"use strict";var u=n("../lib/common_selectors"),e=u.noTarget,o=u.isOfMetaType,s=u.isInactiveFeature,h=u.isShiftDown,a=n("../lib/create_supplementary_points"),v=n("../lib/constrain_feature_movement"),c=n("../lib/double_click_zoom"),r=n("../constants"),f=n("../lib/common_selectors"),y=n("../lib/move_features"),l=o(r.meta.VERTEX),p=o(r.meta.MIDPOINT),i={};i.fireUpdate=function(){this.map.fire(r.events.UPDATE,{action:r.updateActions.CHANGE_COORDINATES,features:this.getSelected().map(function(n){return n.toGeoJSON()})})};i.fireActionable=function(n){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:n.selectedCoordPaths.length>0})};i.startDragging=function(n,t){this.map.dragPan.disable();n.canDragMove=!0;n.dragMoveLocation=t.lngLat};i.stopDragging=function(n){this.map.dragPan.enable();n.dragMoving=!1;n.canDragMove=!1;n.dragMoveLocation=null};i.onVertex=function(n,t){var i,r,u;this.startDragging(n,t);i=t.featureTarget.properties;r=n.selectedCoordPaths.indexOf(i.coord_path);h(t)||r!==-1?h(t)&&r===-1&&n.selectedCoordPaths.push(i.coord_path):n.selectedCoordPaths=[i.coord_path];u=this.pathsToCoordinates(n.featureId,n.selectedCoordPaths);this.setSelectedCoordinates(u)};i.onMidpoint=function(n,t){this.startDragging(n,t);var i=t.featureTarget.properties;n.feature.addCoordinate(i.coord_path,i.lng,i.lat);this.fireUpdate();n.selectedCoordPaths=[i.coord_path]};i.pathsToCoordinates=function(n,t){return t.map(function(t){return{feature_id:n,coord_path:t}})};i.onFeature=function(n,t){n.selectedCoordPaths.length===0?this.startDragging(n,t):this.stopDragging(n)};i.dragFeature=function(n,t,i){y(this.getSelected(),i);n.dragMoveLocation=t.lngLat};i.dragVertex=function(n,t,i){for(var e,f=n.selectedCoordPaths.map(function(t){return n.feature.getCoordinate(t)}),s=f.map(function(n){return{type:r.geojsonTypes.FEATURE,properties:{},geometry:{type:r.geojsonTypes.POINT,coordinates:n}}}),o=v(s,i),u=0;u<f.length;u++)e=f[u],n.feature.updateCoordinate(n.selectedCoordPaths[u],e[0]+o.lng,e[1]+o.lat)};i.clickNoTarget=function(){this.changeMode(r.modes.SIMPLE_SELECT)};i.clickInactive=function(){this.changeMode(r.modes.SIMPLE_SELECT)};i.clickActiveFeature=function(n){n.selectedCoordPaths=[];this.clearSelectedCoordinates();n.feature.changed()};i.onSetup=function(n){var t=n.featureId,i=this.getFeature(t),u;if(!i)throw new Error("You must provide a featureId to enter direct_select mode");if(i.type===r.geojsonTypes.POINT)throw new TypeError("direct_select mode doesn't handle point features");return u={featureId:t,feature:i,dragMoveLocation:n.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:n.coordPath?[n.coordPath]:[]},this.setSelectedCoordinates(this.pathsToCoordinates(t,u.selectedCoordPaths)),this.setSelected(t),c.disable(this),this.setActionableState({trash:!0}),u};i.onStop=function(){c.enable(this);this.clearSelectedCoordinates()};i.toDisplayFeatures=function(n,t,i){n.featureId===t.properties.id?(t.properties.active=r.activeStates.ACTIVE,i(t),a(t,{map:this.map,midpoints:!0,selectedPaths:n.selectedCoordPaths}).forEach(i)):(t.properties.active=r.activeStates.INACTIVE,i(t));this.fireActionable(n)};i.onTrash=function(n){n.selectedCoordPaths.sort().reverse().forEach(function(t){return n.feature.removeCoordinate(t)});this.fireUpdate();n.selectedCoordPaths=[];this.clearSelectedCoordinates();this.fireActionable(n);n.feature.isValid()===!1&&(this.deleteFeature([n.featureId]),this.changeMode(r.modes.SIMPLE_SELECT,{}))};i.onMouseMove=function(n,t){var u=f.isActiveFeature(t),e=l(t),i=n.selectedCoordPaths.length===0;u&&i?this.updateUIClasses({mouse:r.cursors.MOVE}):e&&!i?this.updateUIClasses({mouse:r.cursors.MOVE}):this.updateUIClasses({mouse:r.cursors.NONE});this.stopDragging(n)};i.onMouseOut=function(n){n.dragMoving&&this.fireUpdate()};i.onTouchStart=i.onMouseDown=function(n,t){if(l(t))return this.onVertex(n,t);if(f.isActiveFeature(t))return this.onFeature(n,t);if(p(t))return this.onMidpoint(n,t)};i.onDrag=function(n,t){if(n.canDragMove===!0){n.dragMoving=!0;t.originalEvent.stopPropagation();var i={lng:t.lngLat.lng-n.dragMoveLocation.lng,lat:t.lngLat.lat-n.dragMoveLocation.lat};n.selectedCoordPaths.length>0?this.dragVertex(n,t,i):this.dragFeature(n,t,i);n.dragMoveLocation=t.lngLat}};i.onClick=function(n,t){if(e(t))return this.clickNoTarget(n,t);if(f.isActiveFeature(t))return this.clickActiveFeature(n,t);if(s(t))return this.clickInactive(n,t);this.stopDragging(n)};i.onTap=function(n,t){return e(t)?this.clickNoTarget(n,t):f.isActiveFeature(t)?this.clickActiveFeature(n,t):s(t)?this.clickInactive(n,t):void 0};i.onTouchEnd=i.onMouseUp=function(n){n.dragMoving&&this.fireUpdate();this.stopDragging(n)};t.exports=i},{"../constants":23,"../lib/common_selectors":30,"../lib/constrain_feature_movement":31,"../lib/create_supplementary_points":33,"../lib/double_click_zoom":35,"../lib/move_features":45}],53:[function(n,t){"use strict";function f(n){return c(n)||h(n)||s()}function s(){throw new TypeError("Invalid attempt to spread non-iterable instance");}function h(n){if(Symbol.iterator in Object(n)||Object.prototype.toString.call(n)==="[object Arguments]")return Array.from(n)}function c(n){if(Array.isArray(n)){for(var t=0,i=new Array(n.length);t<n.length;t++)i[t]=n[t];return i}}var u=n("../lib/common_selectors"),e=n("../lib/is_event_at_coordinates"),o=n("../lib/double_click_zoom"),i=n("../constants"),l=n("../lib/create_vertex"),r={};r.onSetup=function(n){var s,r,u,h,t,e,c,l;if(n=n||{},s=n.featureId,h="forward",s){if(r=this.getFeature(s),!r)throw new Error("Could not find a feature with the provided featureId");if(t=n.from,t&&t.type==="Feature"&&t.geometry&&t.geometry.type==="Point"&&(t=t.geometry),t&&t.type==="Point"&&t.coordinates&&t.coordinates.length===2&&(t=t.coordinates),!t||!Array.isArray(t))throw new Error("Please use the `from` property to indicate which point to continue the line from");if(e=r.coordinates.length-1,r.coordinates[e][0]===t[0]&&r.coordinates[e][1]===t[1])u=e+1,(c=r).addCoordinate.apply(c,[u].concat(f(r.coordinates[e])));else if(r.coordinates[0][0]===t[0]&&r.coordinates[0][1]===t[1])h="backwards",u=0,(l=r).addCoordinate.apply(l,[u].concat(f(r.coordinates[0])));else throw new Error("`from` should match the point at either the start or the end of the provided LineString");}else r=this.newFeature({type:i.geojsonTypes.FEATURE,properties:{},geometry:{type:i.geojsonTypes.LINE_STRING,coordinates:[]}}),u=0,this.addFeature(r);return this.clearSelectedFeatures(),o.disable(this),this.updateUIClasses({mouse:i.cursors.ADD}),this.activateUIButton(i.types.LINE),this.setActionableState({trash:!0}),{line:r,currentVertexPosition:u,direction:h}};r.clickAnywhere=function(n,t){if(n.currentVertexPosition>0&&e(t,n.line.coordinates[n.currentVertexPosition-1])||n.direction==="backwards"&&e(t,n.line.coordinates[n.currentVertexPosition+1]))return this.changeMode(i.modes.SIMPLE_SELECT,{featureIds:[n.line.id]});this.updateUIClasses({mouse:i.cursors.ADD});n.line.updateCoordinate(n.currentVertexPosition,t.lngLat.lng,t.lngLat.lat);n.direction==="forward"?(n.currentVertexPosition++,n.line.updateCoordinate(n.currentVertexPosition,t.lngLat.lng,t.lngLat.lat)):n.line.addCoordinate(0,t.lngLat.lng,t.lngLat.lat)};r.clickOnVertex=function(n){return this.changeMode(i.modes.SIMPLE_SELECT,{featureIds:[n.line.id]})};r.onMouseMove=function(n,t){n.line.updateCoordinate(n.currentVertexPosition,t.lngLat.lng,t.lngLat.lat);u.isVertex(t)&&this.updateUIClasses({mouse:i.cursors.POINTER})};r.onTap=r.onClick=function(n,t){if(u.isVertex(t))return this.clickOnVertex(n,t);this.clickAnywhere(n,t)};r.onKeyUp=function(n,t){u.isEnterKey(t)?this.changeMode(i.modes.SIMPLE_SELECT,{featureIds:[n.line.id]}):u.isEscapeKey(t)&&(this.deleteFeature([n.line.id],{silent:!0}),this.changeMode(i.modes.SIMPLE_SELECT))};r.onStop=function(n){(o.enable(this),this.activateUIButton(),this.getFeature(n.line.id)!==undefined)&&(n.line.removeCoordinate("".concat(n.currentVertexPosition)),n.line.isValid()?this.map.fire(i.events.CREATE,{features:[n.line.toGeoJSON()]}):(this.deleteFeature([n.line.id],{silent:!0}),this.changeMode(i.modes.SIMPLE_SELECT,{},{silent:!0})))};r.onTrash=function(n){this.deleteFeature([n.line.id],{silent:!0});this.changeMode(i.modes.SIMPLE_SELECT)};r.toDisplayFeatures=function(n,t,r){var u=t.properties.id===n.line.id;if(t.properties.active=u?i.activeStates.ACTIVE:i.activeStates.INACTIVE,!u)return r(t);t.geometry.coordinates.length<2||(t.properties.meta=i.meta.FEATURE,r(l(n.line.id,t.geometry.coordinates[n.direction==="forward"?t.geometry.coordinates.length-2:1],"".concat(n.direction==="forward"?t.geometry.coordinates.length-2:1),!1)),r(t))};t.exports=r},{"../constants":23,"../lib/common_selectors":30,"../lib/create_vertex":34,"../lib/double_click_zoom":35,"../lib/is_event_at_coordinates":40}],54:[function(n,t){"use strict";var u=n("../lib/common_selectors"),i=n("../constants"),r={};r.onSetup=function(){var n=this.newFeature({type:i.geojsonTypes.FEATURE,properties:{},geometry:{type:i.geojsonTypes.POINT,coordinates:[]}});return this.addFeature(n),this.clearSelectedFeatures(),this.updateUIClasses({mouse:i.cursors.ADD}),this.activateUIButton(i.types.POINT),this.setActionableState({trash:!0}),{point:n}};r.stopDrawingAndRemove=function(n){this.deleteFeature([n.point.id],{silent:!0});this.changeMode(i.modes.SIMPLE_SELECT)};r.onTap=r.onClick=function(n,t){this.updateUIClasses({mouse:i.cursors.MOVE});n.point.updateCoordinate("",t.lngLat.lng,t.lngLat.lat);this.map.fire(i.events.CREATE,{features:[n.point.toGeoJSON()]});this.changeMode(i.modes.SIMPLE_SELECT,{featureIds:[n.point.id]})};r.onStop=function(n){this.activateUIButton();n.point.getCoordinate().length||this.deleteFeature([n.point.id],{silent:!0})};r.toDisplayFeatures=function(n,t,r){var u=t.properties.id===n.point.id;return t.properties.active=u?i.activeStates.ACTIVE:i.activeStates.INACTIVE,u?void 0:r(t)};r.onTrash=r.stopDrawingAndRemove;r.onKeyUp=function(n,t){if(u.isEscapeKey(t)||u.isEnterKey(t))return this.stopDrawingAndRemove(n,t)};t.exports=r},{"../constants":23,"../lib/common_selectors":30}],55:[function(n,t){"use strict";var u=n("../lib/common_selectors"),f=n("../lib/double_click_zoom"),i=n("../constants"),o=n("../lib/is_event_at_coordinates"),e=n("../lib/create_vertex"),r={};r.onSetup=function(){var n=this.newFeature({type:i.geojsonTypes.FEATURE,properties:{},geometry:{type:i.geojsonTypes.POLYGON,coordinates:[[]]}});return this.addFeature(n),this.clearSelectedFeatures(),f.disable(this),this.updateUIClasses({mouse:i.cursors.ADD}),this.activateUIButton(i.types.POLYGON),this.setActionableState({trash:!0}),{polygon:n,currentVertexPosition:0}};r.clickAnywhere=function(n,t){if(n.currentVertexPosition>0&&o(t,n.polygon.coordinates[0][n.currentVertexPosition-1]))return this.changeMode(i.modes.SIMPLE_SELECT,{featureIds:[n.polygon.id]});this.updateUIClasses({mouse:i.cursors.ADD});n.polygon.updateCoordinate("0.".concat(n.currentVertexPosition),t.lngLat.lng,t.lngLat.lat);n.currentVertexPosition++;n.polygon.updateCoordinate("0.".concat(n.currentVertexPosition),t.lngLat.lng,t.lngLat.lat)};r.clickOnVertex=function(n){return this.changeMode(i.modes.SIMPLE_SELECT,{featureIds:[n.polygon.id]})};r.onMouseMove=function(n,t){n.polygon.updateCoordinate("0.".concat(n.currentVertexPosition),t.lngLat.lng,t.lngLat.lat);u.isVertex(t)&&this.updateUIClasses({mouse:i.cursors.POINTER})};r.onTap=r.onClick=function(n,t){return u.isVertex(t)?this.clickOnVertex(n,t):this.clickAnywhere(n,t)};r.onKeyUp=function(n,t){u.isEscapeKey(t)?(this.deleteFeature([n.polygon.id],{silent:!0}),this.changeMode(i.modes.SIMPLE_SELECT)):u.isEnterKey(t)&&this.changeMode(i.modes.SIMPLE_SELECT,{featureIds:[n.polygon.id]})};r.onStop=function(n){(this.updateUIClasses({mouse:i.cursors.NONE}),f.enable(this),this.activateUIButton(),this.getFeature(n.polygon.id)!==undefined)&&(n.polygon.removeCoordinate("0.".concat(n.currentVertexPosition)),n.polygon.isValid()?this.map.fire(i.events.CREATE,{features:[n.polygon.toGeoJSON()]}):(this.deleteFeature([n.polygon.id],{silent:!0}),this.changeMode(i.modes.SIMPLE_SELECT,{},{silent:!0})))};r.toDisplayFeatures=function(n,t,r){var o=t.properties.id===n.polygon.id,u,f,s;return(t.properties.active=o?i.activeStates.ACTIVE:i.activeStates.INACTIVE,!o)?r(t):t.geometry.coordinates.length===0?void 0:(u=t.geometry.coordinates[0].length,u<3)?void 0:(t.properties.meta=i.meta.FEATURE,r(e(n.polygon.id,t.geometry.coordinates[0][0],"0.0",!1)),u>3&&(f=t.geometry.coordinates[0].length-3,r(e(n.polygon.id,t.geometry.coordinates[0][f],"0.".concat(f),!1))),u<=4&&(s=[[t.geometry.coordinates[0][0][0],t.geometry.coordinates[0][0][1]],[t.geometry.coordinates[0][1][0],t.geometry.coordinates[0][1][1]]],r({type:i.geojsonTypes.FEATURE,properties:t.properties,geometry:{coordinates:s,type:i.geojsonTypes.LINE_STRING}}),u===3))?void 0:r(t)};r.onTrash=function(n){this.deleteFeature([n.polygon.id],{silent:!0});this.changeMode(i.modes.SIMPLE_SELECT)};t.exports=r},{"../constants":23,"../lib/common_selectors":30,"../lib/create_vertex":34,"../lib/double_click_zoom":35,"../lib/is_event_at_coordinates":40}],56:[function(n,t){"use strict";t.exports={simple_select:n("./simple_select"),direct_select:n("./direct_select"),draw_point:n("./draw_point"),draw_polygon:n("./draw_polygon"),draw_line_string:n("./draw_line_string")}},{"./direct_select":52,"./draw_line_string":53,"./draw_point":54,"./draw_polygon":55,"./simple_select":60}],57:[function(n,t){"use strict";var i=t.exports=n("./mode_interface_accessors");i.prototype.onSetup=function(){};i.prototype.onDrag=function(){};i.prototype.onClick=function(){};i.prototype.onMouseMove=function(){};i.prototype.onMouseDown=function(){};i.prototype.onMouseUp=function(){};i.prototype.onMouseOut=function(){};i.prototype.onKeyUp=function(){};i.prototype.onKeyDown=function(){};i.prototype.onTouchStart=function(){};i.prototype.onTouchMove=function(){};i.prototype.onTouchEnd=function(){};i.prototype.onTap=function(){};i.prototype.onStop=function(){};i.prototype.onTrash=function(){};i.prototype.onCombineFeature=function(){};i.prototype.onUncombineFeature=function(){};i.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures");}},{"./mode_interface_accessors":58}],58:[function(n,t){"use strict";var r=n("../constants"),s=n("../lib/features_at"),u=n("../feature_types/point"),f=n("../feature_types/line_string"),e=n("../feature_types/polygon"),o=n("../feature_types/multi_feature"),i=t.exports=function(n){this.map=n.map;this.drawConfig=JSON.parse(JSON.stringify(n.options||{}));this._ctx=n};i.prototype.setSelected=function(n){return this._ctx.store.setSelected(n)};i.prototype.setSelectedCoordinates=function(n){var t=this;this._ctx.store.setSelectedCoordinates(n);n.reduce(function(n,i){return n[i.feature_id]===undefined&&(n[i.feature_id]=!0,t._ctx.store.get(i.feature_id).changed()),n},{})};i.prototype.getSelected=function(){return this._ctx.store.getSelected()};i.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()};i.prototype.isSelected=function(n){return this._ctx.store.isSelected(n)};i.prototype.getFeature=function(n){return this._ctx.store.get(n)};i.prototype.select=function(n){return this._ctx.store.select(n)};i.prototype.deselect=function(n){return this._ctx.store.deselect(n)};i.prototype.deleteFeature=function(n){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return this._ctx.store.delete(n,t)};i.prototype.addFeature=function(n){return this._ctx.store.add(n)};i.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()};i.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()};i.prototype.setActionableState=function(){var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},t={trash:n.trash||!1,combineFeatures:n.combineFeatures||!1,uncombineFeatures:n.uncombineFeatures||!1};return this._ctx.events.actionable(t)};i.prototype.changeMode=function(n){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};return this._ctx.events.changeMode(n,t,i)};i.prototype.updateUIClasses=function(n){return this._ctx.ui.queueMapClasses(n)};i.prototype.activateUIButton=function(n){return this._ctx.ui.setActiveButton(n)};i.prototype.featuresAt=function(n,t){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"click";if(i!=="click"&&i!=="touch")throw new Error("invalid buffer type");return s[i](n,t,this._ctx)};i.prototype.newFeature=function(n){var t=n.geometry.type;return t===r.geojsonTypes.POINT?new u(this._ctx,n):t===r.geojsonTypes.LINE_STRING?new f(this._ctx,n):t===r.geojsonTypes.POLYGON?new e(this._ctx,n):new o(this._ctx,n)};i.prototype.isInstanceOf=function(n,t){if(n===r.geojsonTypes.POINT)return t instanceof u;if(n===r.geojsonTypes.LINE_STRING)return t instanceof f;if(n===r.geojsonTypes.POLYGON)return t instanceof e;if(n==="MultiFeature")return t instanceof o;throw new Error("Unknown feature class: ".concat(n));};i.prototype.doRender=function(n){return this._ctx.store.featureChanged(n)}},{"../constants":23,"../feature_types/line_string":26,"../feature_types/multi_feature":27,"../feature_types/point":28,"../feature_types/polygon":29,"../lib/features_at":37}],59:[function(n,t){"use strict";var r=n("./mode_interface"),i={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},u=Object.keys(i);t.exports=function(n){var t=Object.keys(n);return function(f){function h(n){return function(t){o[n](e,t)}}var s=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},e={},o=t.reduce(function(t,i){return t[i]=n[i],t},new r(f));return{start:function(){var t=this;e=o.onSetup(s);u.forEach(function(r){var u=i[r],f=function(){return!1};n[u]&&(f=function(){return!0});t.on(r,f,h(u))})},stop:function(){o.onStop(e)},trash:function(){o.onTrash(e)},combineFeatures:function(){o.onCombineFeatures(e)},uncombineFeatures:function(){o.onUncombineFeatures(e)},render:function(n,t){o.toDisplayFeatures(e,n,t)}}}}},{"./mode_interface":57}],60:[function(n,t){"use strict";var u=n("../lib/common_selectors"),e=n("../lib/mouse_event_point"),o=n("../lib/create_supplementary_points"),s=n("../lib/string_set"),f=n("../lib/double_click_zoom"),h=n("../lib/move_features"),r=n("../constants"),i={};i.onSetup=function(n){var i=this,t={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:undefined,boxSelecting:!1,canBoxSelect:!1,dragMoveing:!1,canDragMove:!1,initiallySelectedFeatureIds:n.featureIds||[]};return this.setSelected(t.initiallySelectedFeatureIds.filter(function(n){return i.getFeature(n)!==undefined})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),t};i.fireUpdate=function(){this.map.fire(r.events.UPDATE,{action:r.updateActions.MOVE,features:this.getSelected().map(function(n){return n.toGeoJSON()})})};i.fireActionable=function(){var f=this,n=this.getSelected(),e=n.filter(function(n){return f.isInstanceOf("MultiFeature",n)}),t=!1,i,r,u;n.length>1&&(t=!0,i=n[0].type.replace("Multi",""),n.forEach(function(n){n.type.replace("Multi","")!==i&&(t=!1)}));r=e.length>0;u=n.length>0;this.setActionableState({combineFeatures:t,uncombineFeatures:r,trash:u})};i.getUniqueIds=function(n){if(!n.length)return[];var t=n.map(function(n){return n.properties.id}).filter(function(n){return n!==undefined}).reduce(function(n,t){return n.add(t),n},new s);return t.values()};i.stopExtendedInteractions=function(n){n.boxSelectElement&&(n.boxSelectElement.parentNode&&n.boxSelectElement.parentNode.removeChild(n.boxSelectElement),n.boxSelectElement=null);this.map.dragPan.enable();n.boxSelecting=!1;n.canBoxSelect=!1;n.dragMoving=!1;n.canDragMove=!1};i.onStop=function(){f.enable(this)};i.onMouseMove=function(n){return this.stopExtendedInteractions(n)};i.onMouseOut=function(n){if(n.dragMoving)return this.fireUpdate()};i.onTap=i.onClick=function(n,t){return u.noTarget(t)?this.clickAnywhere(n,t):u.isOfMetaType(r.meta.VERTEX)(t)?this.clickOnVertex(n,t):u.isFeature(t)?this.clickOnFeature(n,t):void 0};i.clickAnywhere=function(n){var i=this,t=this.getSelectedIds();t.length&&(this.clearSelectedFeatures(),t.forEach(function(n){return i.doRender(n)}));f.enable(this);this.stopExtendedInteractions(n)};i.clickOnVertex=function(n,t){this.changeMode(r.modes.DIRECT_SELECT,{featureId:t.featureTarget.properties.parent,coordPath:t.featureTarget.properties.coord_path,startPos:t.lngLat});this.updateUIClasses({mouse:r.cursors.MOVE})};i.startOnActiveFeature=function(n,t){this.stopExtendedInteractions(n);this.map.dragPan.disable();this.doRender(t.featureTarget.properties.id);n.canDragMove=!0;n.dragMoveLocation=t.lngLat};i.clickOnFeature=function(n,t){var h=this;f.disable(this);this.stopExtendedInteractions(n);var e=u.isShiftDown(t),s=this.getSelectedIds(),i=t.featureTarget.properties.id,o=this.isSelected(i);if(!e&&o&&this.getFeature(i).type!==r.geojsonTypes.POINT)return this.changeMode(r.modes.DIRECT_SELECT,{featureId:i});o&&e?(this.deselect(i),this.updateUIClasses({mouse:r.cursors.POINTER}),s.length===1&&f.enable(this)):!o&&e?(this.select(i),this.updateUIClasses({mouse:r.cursors.MOVE})):o||e||(s.forEach(function(n){return h.doRender(n)}),this.setSelected(i),this.updateUIClasses({mouse:r.cursors.MOVE}));this.doRender(i)};i.onMouseDown=function(n,t){return u.isActiveFeature(t)?this.startOnActiveFeature(n,t):this.drawConfig.boxSelect&&u.isShiftMousedown(t)?this.startBoxSelect(n,t):void 0};i.startBoxSelect=function(n,t){this.stopExtendedInteractions(n);this.map.dragPan.disable();n.boxSelectStartLocation=e(t.originalEvent,this.map.getContainer());n.canBoxSelect=!0};i.onTouchStart=function(n,t){if(u.isActiveFeature(t))return this.startOnActiveFeature(n,t)};i.onDrag=function(n,t){return n.canDragMove?this.dragMove(n,t):this.drawConfig.boxSelect&&n.canBoxSelect?this.whileBoxSelect(n,t):void 0};i.whileBoxSelect=function(n,t){n.boxSelecting=!0;this.updateUIClasses({mouse:r.cursors.ADD});n.boxSelectElement||(n.boxSelectElement=document.createElement("div"),n.boxSelectElement.classList.add(r.classes.BOX_SELECT),this.map.getContainer().appendChild(n.boxSelectElement));var i=e(t.originalEvent,this.map.getContainer()),u=Math.min(n.boxSelectStartLocation.x,i.x),s=Math.max(n.boxSelectStartLocation.x,i.x),f=Math.min(n.boxSelectStartLocation.y,i.y),h=Math.max(n.boxSelectStartLocation.y,i.y),o="translate(".concat(u,"px, ").concat(f,"px)");n.boxSelectElement.style.transform=o;n.boxSelectElement.style.WebkitTransform=o;n.boxSelectElement.style.width="".concat(s-u,"px");n.boxSelectElement.style.height="".concat(h-f,"px")};i.dragMove=function(n,t){n.dragMoving=!0;t.originalEvent.stopPropagation();var i={lng:t.lngLat.lng-n.dragMoveLocation.lng,lat:t.lngLat.lat-n.dragMoveLocation.lat};h(this.getSelected(),i);n.dragMoveLocation=t.lngLat};i.onMouseUp=function(n,t){var u=this;if(n.dragMoving)this.fireUpdate();else if(n.boxSelecting){var f=[n.boxSelectStartLocation,e(t.originalEvent,this.map.getContainer())],o=this.featuresAt(null,f,"click"),i=this.getUniqueIds(o).filter(function(n){return!u.isSelected(n)});i.length&&(this.select(i),i.forEach(function(n){return u.doRender(n)}),this.updateUIClasses({mouse:r.cursors.MOVE}))}this.stopExtendedInteractions(n)};i.toDisplayFeatures=function(n,t,i){(t.properties.active=this.isSelected(t.properties.id)?r.activeStates.ACTIVE:r.activeStates.INACTIVE,i(t),this.fireActionable(),t.properties.active===r.activeStates.ACTIVE&&t.geometry.type!==r.geojsonTypes.POINT)&&o(t).forEach(i)};i.onTrash=function(){this.deleteFeature(this.getSelectedIds());this.fireActionable()};i.onCombineFeatures=function(){var t=this.getSelected(),u,n,f;if(t.length!==0&&!(t.length<2)){var e=[],i=[],o=t[0].type.replace("Multi","");for(u=0;u<t.length;u++){if(n=t[u],n.type.replace("Multi","")!==o)return;n.type.includes("Multi")?n.getCoordinates().forEach(function(n){e.push(n)}):e.push(n.getCoordinates());i.push(n.toGeoJSON())}i.length>1&&(f=this.newFeature({type:r.geojsonTypes.FEATURE,properties:i[0].properties,geometry:{type:"Multi".concat(o),coordinates:e}}),this.addFeature(f),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([f.id]),this.map.fire(r.events.COMBINE_FEATURES,{createdFeatures:[f.toGeoJSON()],deletedFeatures:i}));this.fireActionable()}};i.onUncombineFeatures=function(){var n=this,i=this.getSelected(),t;if(i.length!==0){var u=[],f=[],e=function(t){var r=i[t];n.isInstanceOf("MultiFeature",r)&&(r.getFeatures().forEach(function(t){n.addFeature(t);t.properties=r.properties;u.push(t.toGeoJSON());n.select([t.id])}),n.deleteFeature(r.id,{silent:!0}),f.push(r.toGeoJSON()))};for(t=0;t<i.length;t++)e(t);u.length>1&&this.map.fire(r.events.UNCOMBINE_FEATURES,{createdFeatures:u,deletedFeatures:f});this.fireActionable()}};t.exports=i},{"../constants":23,"../lib/common_selectors":30,"../lib/create_supplementary_points":33,"../lib/double_click_zoom":35,"../lib/mouse_event_point":44,"../lib/move_features":45,"../lib/string_set":47}],61:[function(n,t){"use strict";function u(n,t){return n.map(function(n){return n.source?n:i(n,{id:"".concat(n.id,".").concat(t),source:t==="hot"?r.sources.HOT:r.sources.COLD})})}var i=n("xtend"),r=n("./constants"),f={defaultMode:r.modes.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:n("./lib/theme"),modes:n("./modes"),controls:{},userProperties:!1},e={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},o={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};t.exports=function(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{},n=i(t);return t.controls||(n.controls={}),n.controls=t.displayControlsDefault===!1?i(o,t.controls):i(e,t.controls),n=i(f,n),n.styles=u(n.styles,"cold").concat(u(n.styles,"hot")),n}},{"./constants":23,"./lib/theme":49,"./modes":56,xtend:21}],62:[function(n,t){"use strict";var i=n("./constants");t.exports=function(){function o(t,i){var r=n.get(t),f=r.internal(u);n.ctx.events.currentModeRender(f,function(t){n.sources[i].push(t)})}function h(){n.isDirty=!1;n.clearChangedIds()}var n=this,c=n.ctx.map&&n.ctx.map.getSource(i.sources.HOT)!==undefined,u,t,r,f,e,s;if(!c)return h();u=n.ctx.events.currentModeName();n.ctx.ui.queueMapClasses({mode:u});t=[];r=[];n.isDirty?r=n.getAllIds():(t=n.getChangedIds().filter(function(t){return n.get(t)!==undefined}),r=n.sources.hot.filter(function(i){return i.properties.id&&t.indexOf(i.properties.id)===-1&&n.get(i.properties.id)!==undefined}).map(function(n){return n.properties.id}));n.sources.hot=[];f=n.sources.cold.length;n.sources.cold=n.isDirty?[]:n.sources.cold.filter(function(n){var i=n.properties.id||n.properties.parent;return t.indexOf(i)===-1});e=f!==n.sources.cold.length||r.length>0;t.forEach(function(n){return o(n,"hot")});r.forEach(function(n){return o(n,"cold")});e&&n.ctx.map.getSource(i.sources.COLD).setData({type:i.geojsonTypes.FEATURE_COLLECTION,features:n.sources.cold});n.ctx.map.getSource(i.sources.HOT).setData({type:i.geojsonTypes.FEATURE_COLLECTION,features:n.sources.hot});n._emitSelectionChange&&(n.ctx.map.fire(i.events.SELECTION_CHANGE,{features:n.getSelected().map(function(n){return n.toGeoJSON()}),points:n.getSelectedCoordinates().map(function(n){return{type:i.geojsonTypes.FEATURE,properties:{},geometry:{type:i.geojsonTypes.POINT,coordinates:n.coordinates}}})}),n._emitSelectionChange=!1);n._deletedFeaturesToEmit.length&&(s=n._deletedFeaturesToEmit.map(function(n){return n.toGeoJSON()}),n._deletedFeaturesToEmit=[],n.ctx.map.fire(i.events.DELETE,{features:s}));h();n.ctx.map.fire(i.events.RENDER,{})}},{"./constants":23}],63:[function(n,t){"use strict";var r=n("./events"),u=n("./store"),f=n("./ui"),i=n("./constants"),e=n("xtend");t.exports=function(n){var o=null,s=null,t={onRemove:function(){return n.map.off("load",t.connect),clearInterval(s),t.removeLayers(),n.store.restoreMapConfig(),n.ui.removeButtons(),n.events.removeEventListeners(),n.ui.clearMapClasses(),n.map=null,n.container=null,n.store=null,o&&o.parentNode&&o.parentNode.removeChild(o),o=null,this},connect:function(){n.map.off("load",t.connect);clearInterval(s);t.addLayers();n.store.storeMapConfig();n.events.addEventListeners()},onAdd:function(i){if(1){var h=i.fire;i.fire=function(n,t){var r=arguments;return h.length===1&&arguments.length!==1&&(r=[e({},{type:n},t)]),h.apply(i,r)}}if(n.map=i,n.events=r(n),n.ui=f(n),n.container=i.getContainer(),n.store=new u(n),o=n.ui.addButtons(),n.options.boxSelect&&(i.boxZoom.disable(),i.dragPan.disable(),i.dragPan.enable()),i.loaded())t.connect();else{i.on("load",t.connect);s=setInterval(function(){i.loaded()&&t.connect()},16)}return n.events.start(),o},addLayers:function(){n.map.addSource(i.sources.COLD,{data:{type:i.geojsonTypes.FEATURE_COLLECTION,features:[]},type:"geojson"});n.map.addSource(i.sources.HOT,{data:{type:i.geojsonTypes.FEATURE_COLLECTION,features:[]},type:"geojson"});n.options.styles.forEach(function(t){n.map.addLayer(t)});n.store.setDirty(!0);n.store.render()},removeLayers:function(){n.options.styles.forEach(function(t){n.map.getLayer(t.id)&&n.map.removeLayer(t.id)});n.map.getSource(i.sources.COLD)&&n.map.removeSource(i.sources.COLD);n.map.getSource(i.sources.HOT)&&n.map.removeSource(i.sources.HOT)}};return n.setup=t,t}},{"./constants":23,"./events":24,"./store":64,"./ui":65,xtend:21}],64:[function(n,t){"use strict";function f(n){var i=this,t=this._selectedCoordinates.filter(function(n){return i._selectedFeatureIds.has(n.feature_id)});this._selectedCoordinates.length===t.length||n.silent||(this._emitSelectionChange=!0);this._selectedCoordinates=t}var e=n("./lib/throttle"),r=n("./lib/to_dense_array"),u=n("./lib/string_set"),o=n("./render"),s=n("./constants").interactions,i=t.exports=function(n){this._features={};this._featureIds=new u;this._selectedFeatureIds=new u;this._selectedCoordinates=[];this._changedFeatureIds=new u;this._deletedFeaturesToEmit=[];this._emitSelectionChange=!1;this._mapInitialConfig={};this.ctx=n;this.sources={hot:[],cold:[]};this.render=e(o,16,this);this.isDirty=!1};i.prototype.createRenderBatch=function(){var n=this,i=this.render,t=0;return this.render=function(){t++},function(){n.render=i;t>0&&n.render()}};i.prototype.setDirty=function(){return this.isDirty=!0,this};i.prototype.featureChanged=function(n){return this._changedFeatureIds.add(n),this};i.prototype.getChangedIds=function(){return this._changedFeatureIds.values()};i.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this};i.prototype.getAllIds=function(){return this._featureIds.values()};i.prototype.add=function(n){return this.featureChanged(n.id),this._features[n.id]=n,this._featureIds.add(n.id),this};i.prototype.delete=function(n){var t=this,i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return r(n).forEach(function(n){t._featureIds.has(n)&&(t._featureIds.delete(n),t._selectedFeatureIds.delete(n),i.silent||t._deletedFeaturesToEmit.indexOf(t._features[n])===-1&&t._deletedFeaturesToEmit.push(t._features[n]),delete t._features[n],t.isDirty=!0)}),f.call(this,i),this};i.prototype.get=function(n){return this._features[n]};i.prototype.getAll=function(){var n=this;return Object.keys(this._features).map(function(t){return n._features[t]})};i.prototype.select=function(n){var t=this,i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return r(n).forEach(function(n){t._selectedFeatureIds.has(n)||(t._selectedFeatureIds.add(n),t._changedFeatureIds.add(n),i.silent||(t._emitSelectionChange=!0))}),this};i.prototype.deselect=function(n){var t=this,i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return r(n).forEach(function(n){t._selectedFeatureIds.has(n)&&(t._selectedFeatureIds.delete(n),t._changedFeatureIds.add(n),i.silent||(t._emitSelectionChange=!0))}),f.call(this,i),this};i.prototype.clearSelected=function(){var n=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return this.deselect(this._selectedFeatureIds.values(),{silent:n.silent}),this};i.prototype.setSelected=function(n){var i=this,t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return n=r(n),this.deselect(this._selectedFeatureIds.values().filter(function(t){return n.indexOf(t)===-1}),{silent:t.silent}),this.select(n.filter(function(n){return!i._selectedFeatureIds.has(n)}),{silent:t.silent}),this};i.prototype.setSelectedCoordinates=function(n){return this._selectedCoordinates=n,this._emitSelectionChange=!0,this};i.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this};i.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()};i.prototype.getSelected=function(){var n=this;return this._selectedFeatureIds.values().map(function(t){return n.get(t)})};i.prototype.getSelectedCoordinates=function(){var n=this;return this._selectedCoordinates.map(function(t){var i=n.get(t.feature_id);return{coordinates:i.getCoordinate(t.coord_path)}})};i.prototype.isSelected=function(n){return this._selectedFeatureIds.has(n)};i.prototype.setFeatureProperty=function(n,t,i){this.get(n).setProperty(t,i);this.featureChanged(n)};i.prototype.storeMapConfig=function(){var n=this;s.forEach(function(t){var i=n.ctx.map[t];i&&(n._mapInitialConfig[t]=n.ctx.map[t].isEnabled())})};i.prototype.restoreMapConfig=function(){var n=this;Object.keys(this._mapInitialConfig).forEach(function(t){var i=n._mapInitialConfig[t];i?n.ctx.map[t].enable():n.ctx.map[t].disable()})};i.prototype.getInitialConfigValue=function(n){return this._mapInitialConfig[n]!==undefined?this._mapInitialConfig[n]:!0}},{"./constants":23,"./lib/string_set":47,"./lib/throttle":50,"./lib/to_dense_array":51,"./render":62}],65:[function(n,t){"use strict";var r=n("xtend"),i=n("./constants"),u=["mode","feature","mouse"];t.exports=function(n){function v(){h({mode:null,feature:null,mouse:null});c()}function h(n){f=r(f,n)}function c(){if(n.container){var t=[],i=[];u.forEach(function(n){f[n]!==s[n]&&(t.push("".concat(n,"-").concat(s[n])),f[n]!==null&&i.push("".concat(n,"-").concat(f[n])))});t.length>0&&n.container.classList.remove.apply(n.container.classList,t);i.length>0&&n.container.classList.add.apply(n.container.classList,i);s=r(s,f)}}function e(n){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},t=document.createElement("button");return t.className="".concat(i.classes.CONTROL_BUTTON," ").concat(r.className),t.setAttribute("title",r.title),r.container.appendChild(t),t.addEventListener("click",function(t){t.preventDefault();t.stopPropagation();var i=t.target;if(i===o){l();return}a(n);r.onActivate()},!0),t}function l(){o&&(o.classList.remove(i.classes.ACTIVE_BUTTON),o=null)}function a(n){l();var r=t[n];r&&r&&n!=="trash"&&(r.classList.add(i.classes.ACTIVE_BUTTON),o=r)}function y(){var u=n.options.controls,r=document.createElement("div");return(r.className="".concat(i.classes.CONTROL_GROUP," ").concat(i.classes.CONTROL_BASE),!u)?r:(u[i.types.LINE]&&(t[i.types.LINE]=e(i.types.LINE,{container:r,className:i.classes.CONTROL_BUTTON_LINE,title:"LineString tool ".concat(n.options.keybindings?"(l)":""),onActivate:function(){return n.events.changeMode(i.modes.DRAW_LINE_STRING)}})),u[i.types.POLYGON]&&(t[i.types.POLYGON]=e(i.types.POLYGON,{container:r,className:i.classes.CONTROL_BUTTON_POLYGON,title:"Polygon tool ".concat(n.options.keybindings?"(p)":""),onActivate:function(){return n.events.changeMode(i.modes.DRAW_POLYGON)}})),u[i.types.POINT]&&(t[i.types.POINT]=e(i.types.POINT,{container:r,className:i.classes.CONTROL_BUTTON_POINT,title:"Marker tool ".concat(n.options.keybindings?"(m)":""),onActivate:function(){return n.events.changeMode(i.modes.DRAW_POINT)}})),u.trash&&(t.trash=e("trash",{container:r,className:i.classes.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){n.events.trash()}})),u.combine_features&&(t.combine_features=e("combineFeatures",{container:r,className:i.classes.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){n.events.combineFeatures()}})),u.uncombine_features&&(t.uncombine_features=e("uncombineFeatures",{container:r,className:i.classes.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){n.events.uncombineFeatures()}})),r)}function p(){Object.keys(t).forEach(function(n){var i=t[n];i.parentNode&&i.parentNode.removeChild(i);delete t[n]})}var t={},o=null,s={mode:null,feature:null,mouse:null},f={mode:null,feature:null,mouse:null};return{setActiveButton:a,queueMapClasses:h,updateMapClasses:c,clearMapClasses:v,addButtons:y,removeButtons:p}}},{"./constants":23,xtend:21}]},{},[1])(1)});